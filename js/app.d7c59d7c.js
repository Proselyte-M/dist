(function(){"use strict";var t={7474:function(t,e,s){s(4114);var a=s(5471),r=s(5353),i=s(173),n=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",[e(t.layout,{tag:"component"},[e("router-view")],1),e("ErrorToast")],1)},o=[],l=function(){var t=this,e=t._self._c;t._self._setupProxy;return t.error?e("b-toast",{attrs:{visible:"",title:"Error",variant:"danger",solid:"","no-fade":"","no-auto-hide":""},on:{change:t.clearError}},[t.error?[e("strong",[t._v(t._s(t.error.message))]),e("div",[t._v(t._s(t.error.stack))])]:t._e()],2):t._e()},u=[],c=s(8839),d=s(1241);const p=(0,c.nY)("main",{state:()=>({isLoggedIn:!1,username:null,server:null,error:null,menuVisible:!1,artistAlbumSortOrder:(0,d.Mjh)("settings.artistAlbumSortOrder","desc")}),actions:{setError(t){this.error=t},clearError(){this.error=null},setLoginSuccess(t,e){this.isLoggedIn=!0,this.username=t,this.server=e},showMenu(){this.menuVisible=!0},hideMenu(){this.menuVisible=!1},toggleArtistAlbumSortOrder(){this.artistAlbumSortOrder="asc"===this.artistAlbumSortOrder?"desc":"asc"}}});var m=s(1737),h=(0,a.defineComponent)({components:{BToast:m.a},setup(){const t=p();return{error:(0,a.computed)((()=>t.error)),clearError:t.clearError}}}),f=h,y=s(1656),v=(0,y.A)(f,l,u,!1,null,null,null),g=v.exports,b=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",[e("div",{staticClass:"min-vh-100 d-flex"},[e("Sidebar"),e("main",{staticClass:"container-fluid py-2"},[e("TopNav"),t._t("default")],2)],1),e("Player")],1)},k=[],_=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",{staticClass:"d-flex align-items-center mb-2"},[e("button",{staticClass:"navbar-toggler text-white d-md-none",on:{click:t.store.showMenu}},[e("Icon",{attrs:{icon:"nav"}})],1),e("div",{staticClass:"ml-auto"}),e("SearchForm"),t.store.username?[e("b-dropdown",{attrs:{variant:"link",right:"","no-caret":""},scopedSlots:t._u([{key:"button-content",fn:function(){return[e("Avatar",[e("Icon",{attrs:{icon:"person"}})],1)]},proxy:!0}],null,!1,2913106520)},[e("b-dropdown-text",[t._v(" "+t._s(t.store.server)+" ")]),e("b-dropdown-text",[t._v(" "+t._s(t.store.username)+" ")]),e("b-dropdown-divider"),e("b-dropdown-item",{attrs:{href:`${t.store.server}/settings.view`,target:"_blank"}},[t._v(" Server settings ")]),e("b-dropdown-item-button",{on:{click:t.scan}},[t._v(" Scan media folders ")]),e("b-dropdown-item-button",{on:{click:function(e){t.showAboutModal=!0}}},[t._v(" About ")]),e("b-dropdown-divider"),e("b-dropdown-item-button",{on:{click:t.logout}},[t._v(" Log out ")])],1)]:t._e(),e("About",{attrs:{visible:t.showAboutModal},on:{close:function(e){t.showAboutModal=!1}}})],2)},x=[],w=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("b-modal",{attrs:{size:"lg","hide-header":"","hide-footer":"",visible:t.visible},on:{change:function(e){return t.$emit("close")}}},[e("div",{staticClass:"mx-auto mb-3",staticStyle:{width:"200px"}},[e("Logo")],1),e("div",{staticClass:"text-center"},[e("ExternalLink",{attrs:{href:t.url}},[t._v(" GitHub "),e("Icon",{attrs:{icon:"link"}})],1),e("p",[t._v(" Licensed under the AGPLv3 license. ")]),e("div",[t._v("Build: "+t._s(t.build))]),e("div",[t._v("Build date: "+t._s(t.buildDate))])],1),e("div",{staticClass:"d-flex justify-content-end"},[e("button",{staticClass:"btn btn-secondary",on:{click:function(e){return t.$emit("close")}}},[t._v(" Close ")])])])},C=[],A=function(){var t=this,e=t._self._c;return e("div",t._b({staticClass:"d-flex align-items-end logo-container",class:t.$data.staticClass||""},"div",t.$data.attrs,!1),[e("svg",{attrs:{xmlns:"http://www.w3.org/2000/svg",height:"100%",viewBox:"5.74 31.24 123.89 72.89"}},[e("g",{attrs:{transform:"matrix(1.0344 0 0 1.0869 -2.068 -181.521)"}},[e("rect",{attrs:{width:"5.994",height:"23.366",x:"9.929",y:"224.55",rx:"2.997",ry:"2.997"}}),e("rect",{attrs:{width:"5.994",height:"41.989",x:"19.849",y:"215.2",rx:"2.997",ry:"2.819"}}),e("rect",{attrs:{width:"5.994",height:"49.213",x:"29.768",y:"211.49",rx:"2.997",ry:"2.997"}}),e("rect",{attrs:{width:"5.994",height:"58.69",x:"39.688",y:"202.01",rx:"2.997",ry:"3.038"}}),e("rect",{attrs:{width:"5.994",height:"62.402",x:"49.607",y:"198.3",rx:"2.997",ry:"2.997"}}),e("rect",{attrs:{width:"5.994",height:"62.733",x:"59.526",y:"197.97",rx:"2.997",ry:"2.997"}}),e("rect",{attrs:{width:"5.994",height:"58.889",x:"69.446",y:"201.81",rx:"2.997",ry:"2.997"}}),e("rect",{attrs:{width:"5.994",height:"49.412",x:"79.365",y:"211.29",rx:"2.997",ry:"2.997"}}),e("rect",{attrs:{width:"5.994",height:"48.948",x:"89.285",y:"211.75",rx:"2.997",ry:"2.997"}}),e("rect",{attrs:{width:"5.994",height:"44.176",x:"99.204",y:"216.53",rx:"2.997",ry:"2.997"}}),e("rect",{attrs:{width:"5.994",height:"36.886",x:"109.12",y:"223.55",rx:"2.997",ry:"2.997"}}),e("rect",{attrs:{width:"5.994",height:"22.372",x:"119.04",y:"230.78",rx:"2.997",ry:"2.997"}})])]),t._m(0)])},S=[function(){var t=this,e=t._self._c;return e("span",{staticClass:"text-body ml-2 text-nowrap"},[e("span",[t._v("TouHou Music ")]),e("span",{staticClass:"text-muted"},[t._v("😊")])])}],P={},I=(0,y.A)(P,A,S,!1,null,"20384c71",null),T=I.exports,$=(0,a.defineComponent)({components:{Logo:T},props:{visible:{type:Boolean,required:!0}},computed:{build:()=>({NODE_ENV:"production",BASE_URL:"/"}.VUE_APP_BUILD),buildDate:()=>({NODE_ENV:"production",BASE_URL:"/"}.VUE_APP_BUILD_DATE),url:()=>"https://github.com/tamland/airsonic-refix"}}),M=$,L=(0,y.A)(M,w,C,!1,null,null,null),q=L.exports,N=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",[e("form",{staticClass:"form-inline my-2 my-lg-0",on:{submit:function(e){return e.preventDefault(),t.search.apply(null,arguments)}}},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.query,expression:"query"}],staticClass:"form-control mr-sm-2",attrs:{type:"search",placeholder:"Search"},domProps:{value:t.query},on:{input:function(e){e.target.composing||(t.query=e.target.value)}}})])])},R=[],D=(0,a.defineComponent)({data(){return{query:""}},methods:{search(){this.$router.push({name:"search",query:{q:this.query}})}}}),E=D,B=(0,y.A)(E,N,R,!1,null,null,null),z=B.exports,O=s(1114),F=(s(7467),s(4732),s(9577),s(4603),s(7566),s(8721),s(8664)),U=s.n(F);function j(){let t=new Uint8Array(16);window.crypto.getRandomValues(t);const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";return t=t.map((t=>e.charCodeAt(t%e.length))),String.fromCharCode.apply(null,Array.from(t))}function Q(t,e){void 0!==e&&([t[0],t[e]]=[t[e],t[0]]);const s=void 0!==e?1:0,a=t.length-1;for(let r=a;r>s;r--){const e=Math.floor(Math.random()*(r-s+1)+s);[t[r],t[e]]=[t[e],t[r]]}}function V(t,e){return t=[...t],Q(t,e),t}function H(t){return U().hash(t)}function G(t,e){if(t.length!==e.length)return!1;for(let s=0;s<t.length;s++)if(t[s].id!==e[s].id)return!1;return!0}function Y(t){return t.map((t=>t.name)).join(", ")}function Z(t){const e=Object.entries(t).filter((([,t])=>void 0!==t)).map((([t,e])=>Array.isArray(e)?e.map((e=>[t,e])):[[t,e]])).flat();return new URLSearchParams(e).toString()}function J(t){if(!isFinite(t))return"∞";const e=Math.floor(t/60),s=Math.floor(t%60);return(e<10?"0":"")+e+":"+(s<10?"0":"")+s}const W=window.env,X={serverUrl:W?.SERVER_URL||""};var K=s(3122);class tt{constructor(){(0,O.A)(this,"server",""),(0,O.A)(this,"username",""),(0,O.A)(this,"salt",""),(0,O.A)(this,"hash",""),(0,O.A)(this,"password",""),(0,O.A)(this,"authenticated",!1),(0,O.A)(this,"defaultUsername","test"),(0,O.A)(this,"defaultPassword","test"),(0,O.A)(this,"defaultserver","https://play.thmusic.top"),this.server=X.serverUrl||localStorage.getItem("server")||this.defaultserver,this.username=localStorage.getItem("username")||this.defaultUsername,this.salt=localStorage.getItem("salt")||"",this.hash=localStorage.getItem("hash")||"",this.password=localStorage.getItem("password")||this.defaultPassword}saveSession(){X.serverUrl||localStorage.setItem("server",this.server),localStorage.setItem("username",this.username),localStorage.setItem("salt",this.salt),localStorage.setItem("hash",this.hash),localStorage.setItem("password",this.password)}async autoLogin(){if(!this.server||!this.username)return!1;try{const t={salt:this.salt,hash:this.hash,password:this.password};return await et(this.server,this.username,t),this.authenticated=!0,!0}catch{return!1}}async loginWithPassword(t,e,s){const a=j(),r=H(s+a);try{await et(t,e,{hash:r,salt:a}),this.salt=a,this.hash=r,this.password=""}catch{await et(t,e,{password:s}),this.salt="",this.hash="",this.password=s}this.server=t,this.username=e,this.authenticated=!0,this.saveSession()}get urlParams(){return Z((0,K.A)({u:this.username,s:this.salt,t:this.hash,p:this.password}))}logout(){localStorage.clear(),sessionStorage.clear()}isAuthenticated(){return this.authenticated}}async function et(t,e,s){const a=Z((0,K.A)({s:s.salt,t:s.hash,p:s.password},(t=>void 0!==t))),r=`${t}/rest/ping?u=${e}&${a}&v=1.15.0&c=app&f=json`;return fetch(r).then((t=>t.ok?t.json():Promise.reject(new Error(t.statusText)))).then((t=>{const e=t["subsonic-response"];if(!e||"ok"!==e.status){const t=e.error?.message||e.status;throw new Error(t)}}))}const st=Symbol("");function at(){return(0,a.inject)(st)}function rt(){const t=new tt;return Object.assign(t,{install:e=>{e.provide(st,t)}})}var it=(0,a.defineComponent)({components:{About:q,SearchForm:z},setup(){return{store:p(),auth:at()}},data(){return{showAboutModal:!1}},methods:{scan(){return this.$api.scan()},logout(){this.auth.logout(),this.$router.go(0)}}}),nt=it,ot=(0,y.A)(nt,_,x,!1,null,null,null),lt=ot.exports,ut=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",{staticClass:"sidebar-container elevated"},[e("div",{staticClass:"sidebar-fixed d-none d-md-block"},[e("SidebarNav")],1),e("b-sidebar",{staticClass:"d-md-none",attrs:{visible:t.store.menuVisible,"sidebar-class":"elevated","bg-variant":"",shadow:"lg","no-header":"",backdrop:"","backdrop-variant":""},on:{hidden:t.store.hideMenu}},[e("SidebarNav")],1)],1)},ct=[],dt=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("nav",{staticClass:"nav flex-column"},[e("div",{staticClass:"sidebar-brand d-flex justify-content-between align-items-end"},[e("Logo"),e("button",{staticClass:"btn btn-link btn-lg p-0 m-0 d-md-none",on:{click:t.store.hideMenu}},[e("Icon",{attrs:{icon:"x"}})],1)],1),e("router-link",{staticClass:"nav-link",attrs:{to:{name:"home"},exact:""}},[e("Icon",{attrs:{icon:"discover"}}),t._v(" 探索 ")],1),e("router-link",{staticClass:"nav-link",attrs:{to:{name:"queue"}}},[e("Icon",{attrs:{icon:"playlist"}}),t._v(" 播放列表 ")],1),e("small",{staticClass:"sidebar-heading text-muted"},[t._v(" 音乐库 ")]),e("router-link",{staticClass:"nav-link",attrs:{to:{name:"albums-default"}}},[e("Icon",{attrs:{icon:"library"}}),t._v(" 专辑列表 ")],1),e("router-link",{staticClass:"nav-link",attrs:{to:{name:"artists"}}},[e("Icon",{attrs:{icon:"library"}}),t._v(" 社团列表 ")],1),e("router-link",{staticClass:"nav-link",attrs:{to:{name:"playlists"}}},[e("Icon",{attrs:{icon:"list"}}),t._v(" 歌单列表 ")],1),e("PlaylistNav")],1)},pt=[],mt=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",{staticClass:"mw-100"},[e("small",{staticClass:"sidebar-heading text-muted"},[t._v(" 播放列表 "),e("CreatePlaylistModal",{attrs:{visible:t.showAddModal},on:{"update:visible":function(e){t.showAddModal=e}}})],1),e("router-link",{staticClass:"nav-link",attrs:{to:{name:"playlist",params:{id:"random"}}}},[e("Icon",{staticClass:"mr-2",attrs:{icon:"playlist"}}),t._v(" 随机音乐 ")],1),t.playlists?t._l(t.playlists,(function(s){return e("router-link",{key:s.id,staticClass:"nav-link",attrs:{to:{name:"playlist",params:{id:s.id}}}},[e("span",{on:{dragover:t.onDragover,drop:function(e){return t.onDrop(s.id,e)}}},[e("Icon",{staticClass:"mr-2",attrs:{icon:"playlist"}}),t._v(" "+t._s(s.name)+" ")],1)])})):t._e()],2)},ht=[],ft=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("b-modal",{attrs:{visible:t.visible},on:{ok:t.confirm,change:t.change},scopedSlots:t._u([{key:"modal-header-close",fn:function(){return[e("Icon",{attrs:{icon:"x"}})]},proxy:!0},{key:"modal-title",fn:function(){return[t._v(" New playlist ")]},proxy:!0},{key:"modal-ok",fn:function(){return[t._v(" Create ")]},proxy:!0}])},[e("div",{staticClass:"form-group"},[e("label",[t._v("Name")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.name,expression:"name"}],staticClass:"form-control",attrs:{type:"text"},domProps:{value:t.name},on:{input:function(e){e.target.composing||(t.name=e.target.value)}}})])])},yt=[],vt=s(1268);const gt=(0,c.nY)("playlist",{state:()=>({playlists:null}),actions:{load(){return this.api.getPlaylists().then((t=>{this.playlists=(0,vt.A)(t,"createdAt")}))},create(t){return this.api.createPlaylist(t).then((t=>{this.playlists=(0,vt.A)(t,"createdAt")}))},async update({id:t,name:e,comment:s,isPublic:a}){const r=this.playlists?.find((e=>e.id===t));r&&(r.name=e,r.comment=s,r.isPublic=a,await this.api.editPlaylist(t,e,s,a))},async addTracks(t,e){const s=this.playlists?.find((e=>e.id===t));s&&(await this.api.addToPlaylist(t,e),s.updatedAt=(new Date).toISOString(),s.trackCount=(s?.trackCount||0)+e.length)},async removeTrack(t,e){const s=this.playlists?.find((e=>e.id===t));s&&(await this.api.removeFromPlaylist(t,e),s.updatedAt=(new Date).toISOString(),s.trackCount=(s?.trackCount||0)-1)},async delete(t){await this.api.deletePlaylist(t),this.playlists=this.playlists.filter((e=>e.id!==t))}}});var bt=(0,a.defineComponent)({props:{visible:{type:Boolean,required:!0}},setup(t,{emit:e}){const s=(0,a.ref)(""),r=gt();return{name:s,confirm:()=>{r.create(s.value)},change:()=>{s.value="",e("update:visible",!1)}}}}),kt=bt,_t=(0,y.A)(kt,ft,yt,!1,null,null,null),xt=_t.exports,wt=(0,a.defineComponent)({components:{CreatePlaylistModal:xt},setup(){const t=gt(),e=(0,a.computed)((()=>t.playlists?.slice(0,10)));return{playlists:e,addTracks:t.addTracks}},data(){return{playlistName:"",showAddModal:!1}},methods:{async onDrop(t,e){e.preventDefault();const s=e.dataTransfer.getData("application/x-track-id");if(s)return this.addTracks(t,[s]);const a=e.dataTransfer.getData("application/x-album-id");if(a){const e=await this.$api.getAlbumDetails(a);return this.addTracks(t,e.tracks.map((t=>t.id)))}},onDragover(t){(t.dataTransfer?.types.includes("application/x-track-id")||t.dataTransfer?.types.includes("application/x-album-id"))&&(t.dataTransfer.dropEffect="copy",t.preventDefault())}}}),Ct=wt,At=(0,y.A)(Ct,mt,ht,!1,null,null,null),St=At.exports,Pt=(0,a.defineComponent)({components:{Logo:T,PlaylistNav:St},setup(){return{store:p()}}}),It=Pt,Tt=(0,y.A)(It,dt,pt,!1,null,null,null),$t=Tt.exports,Mt=s(7180),Lt=(0,a.defineComponent)({components:{BSidebar:Mt.X,SidebarNav:$t},setup(){return{store:p()}}}),qt=Lt,Nt=(0,y.A)(qt,ut,ct,!1,null,null,null),Rt=Nt.exports,Dt=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",{staticClass:"player elevated d-flex",class:{visible:t.visible}},[e("div",{staticClass:"flex-fill"},[t.track?e("ProgressBar",{staticStyle:{"margin-bottom":"-5px","margin-top":"-9px"}}):t._e(),e("div",{staticClass:"row align-items-center m-0",staticStyle:{"padding-top":"-10px"}},[e("div",{staticClass:"col p-0 d-flex flex-nowrap align-items-center justify-content-start",staticStyle:{width:"0","min-width":"0"}},[t.track?[e("router-link",{staticStyle:{padding:"12px"},attrs:{to:{name:"queue"}}},[t.track.image?e("img",{attrs:{width:"52",height:"52",src:t.track.image}}):e("img",{attrs:{width:"52",height:"52",src:s(6910)}})]),e("div",{staticStyle:{"min-width":"0"}},[e("div",{staticClass:"text-truncate"},[t._v(" "+t._s(t.streamTitle||t.track.title)+" ")]),e("div",{staticClass:"text-truncate text-muted"},[t._v(" "+t._s(t.formatArtists(t.track.artists||[])||t.track.album)+" ")])])]:t._e()],2),e("div",{staticClass:"col-auto p-0"},[e("b-button",{staticClass:"m-2 d-none d-sm-inline-block",attrs:{variant:"link"},on:{click:t.previous}},[e("Icon",{attrs:{icon:"skip-start"}})],1),e("b-button",{staticClass:"m-2",attrs:{variant:"link",size:"lg"},on:{click:t.playPause}},[e("Icon",{attrs:{icon:t.isPlaying?"pause":"play"}})],1),e("b-button",{staticClass:"m-2",attrs:{variant:"link"},on:{click:t.next}},[e("Icon",{attrs:{icon:"skip-end"}})],1)],1),e("div",{staticClass:"col-auto col-sm p-0"},[e("div",{staticClass:"d-flex flex-nowrap justify-content-end pr-3"},[e("div",{staticClass:"m-0 d-none d-md-inline-flex align-items-center"},[t.track&&t.track.isPodcast?[e("b-button",{staticClass:"mb-1",attrs:{id:"player-playback-rate-btn",variant:"icon",title:"Speed"}},[t._v(" "+t._s(t.playbackRate)+"x ")]),e("b-popover",{attrs:{target:"player-playback-rate-btn",placement:"top",triggers:"click blur","no-fade":""}},[e("Slider",{staticClass:"pt-2",staticStyle:{height:"120px"},attrs:{direction:"btt",min:.8,max:2,step:.1,value:t.playbackRate},on:{input:t.setPlaybackRate}})],1)]:t._e(),e("b-button",{staticClass:"m-0",attrs:{title:"Favourite",variant:"link",disabled:t.track&&t.track.isStream},on:{click:t.toggleFavourite}},[e("Icon",{attrs:{icon:t.isFavourite?"heart-fill":"heart"}})],1),e("b-button",{attrs:{id:"player-volume-btn",variant:"link",title:"Volume"}},[e("Icon",{attrs:{icon:t.isMuted?"mute":"volume"}})],1),e("b-popover",{attrs:{target:"player-volume-btn",placement:"top",triggers:"click blur","no-fade":""}},[e("Slider",{staticClass:"pt-2",staticStyle:{height:"120px"},attrs:{direction:"btt",min:0,max:1,step:.01,percent:"",value:t.volume},on:{input:t.setVolume}})],1),e("b-button",{staticClass:"m-0",class:{"text-primary":t.shuffleActive},attrs:{title:"Shuffle",variant:"link"},on:{click:t.toggleShuffle}},[e("Icon",{attrs:{icon:"shuffle"}})],1),e("b-button",{staticClass:"m-0",class:{"text-primary":t.repeatActive},attrs:{title:"Repeat",variant:"link"},on:{click:t.toggleRepeat}},[e("Icon",{attrs:{icon:"repeat"}})],1)],2),e("OverflowMenu",{staticClass:"d-md-none"},[e("b-dropdown-text",[e("div",{staticClass:"d-flex justify-content-between align-items-center"},[e("strong",[t._v("Volume")]),e("Slider",{staticClass:"px-3",staticStyle:{width:"120px"},attrs:{min:0,max:1,step:.01,percent:"",value:t.volume},on:{input:t.setVolume}})],1)]),t.track&&t.track.isPodcast?e("b-dropdown-text",[e("div",{staticClass:"d-flex justify-content-between align-items-center"},[e("strong",[t._v("Speed")]),e("Slider",{staticClass:"px-3",staticStyle:{width:"120px"},attrs:{min:.7,max:2,step:.1,value:t.playbackRate},on:{input:t.setPlaybackRate}})],1)]):t._e(),e("b-dropdown-text",[e("div",{staticClass:"d-flex justify-content-between"},[e("strong",[t._v("Repeat")]),e("SwitchInput",{attrs:{value:t.repeatActive},on:{input:t.toggleRepeat}})],1)]),e("b-dropdown-text",[e("div",{staticClass:"d-flex justify-content-between"},[e("strong",[t._v("Shuffle")]),e("SwitchInput",{attrs:{value:t.shuffleActive},on:{input:t.toggleShuffle}})],1)])],1)],1)])])],1)])},Et=[],Bt=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("VueSlider",t._b({attrs:{value:t.progress,min:0,max:1,interval:1e-5,lazy:!0,contained:!0,"dot-options":{tooltip:"always"},"tooltip-formatter":t.formatter},on:{change:t.seek}},"VueSlider",t.$attrs,!1))},zt=[],Ot=s(378),Ft=s.n(Ot),Ut=(0,a.defineComponent)({components:{VueSlider:Ft()},computed:{progress(){return this.$store.getters["player/progress"]}},methods:{formatter(t){const e=this.$store.state.player.duration,s=t*e;return`${J(s)} / ${J(e)}`},seek(t){this.$store.dispatch("player/seek",t)}}}),jt=Ut,Qt=(0,y.A)(jt,Bt,zt,!1,null,"4366e4e6",null),Vt=Qt.exports;const Ht=(0,c.nY)("favourite",{state:()=>({albums:{},artists:{},tracks:{}}),actions:{load(){return this.api.getFavourites().then((t=>{this.albums=Gt(t.albums),this.artists=Gt(t.artists),this.tracks=Gt(t.tracks)}))},toggle(t,e){const s=Yt(t);return this[s][e]?(a["default"].delete(this[s],e),this.api.removeFavourite(e,t)):(a["default"].set(this[s],e,!0),this.api.addFavourite(e,t))}}});function Gt(t){return Object.assign({},...t.map((t=>({[t.id]:!0}))))}function Yt(t){switch(t){case"album":return"albums";case"artist":return"artists";case"track":return"tracks";default:throw new Error(`unknown favourite type '${t}'`)}}var Zt=s(5840),Jt=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",{staticClass:"custom-control custom-switch"},[e("input",{staticClass:"custom-control-input",attrs:{id:t.id,type:"checkbox"},domProps:{checked:t.value},on:{change:function(e){return t.$emit("input",e.target.checked)}}}),e("label",{staticClass:"custom-control-label",attrs:{for:t.id}})])},Wt=[],Xt=s(5664),Kt=(0,a.defineComponent)({props:{value:{type:Boolean,default:!1}},computed:{id(){return(0,Xt.A)("switch-")}}}),te=Kt,ee=(0,y.A)(te,Jt,Wt,!1,null,null,null),se=ee.exports,ae=(0,a.defineComponent)({components:{SwitchInput:se,BPopover:Zt.u,ProgressBar:Vt},setup(){return{favouriteStore:Ht()}},computed:{visible(){return this.$store.state.player.queue.length>0},isPlaying(){return this.$store.state.player.isPlaying},volume(){return this.$store.state.player.volume},isMuted(){return this.$store.state.player.volume<=0},repeatActive(){return this.$store.state.player.repeat},shuffleActive(){return this.$store.state.player.shuffle},playbackRate(){return this.$store.getters["player/playbackRate"]},isFavourite(){return this.track&&!!this.favouriteStore.tracks[this.track.id]},track(){return this.$store.getters["player/track"]},streamTitle(){return this.$store.state.streamTitle},documentTitle(){return[this.streamTitle||this.track?.title,Y(this.track?.artists||[])||this.track?.album,"Airsonic (refix)"].filter((t=>!!t)).join(" • ")}},watch:{documentTitle:{immediate:!0,handler(t){document.title=t}}},methods:{playPause(){return this.$store.dispatch("player/playPause")},next(){return this.$store.dispatch("player/next")},previous(){return this.$store.dispatch("player/previous")},setVolume(t){return this.$store.dispatch("player/setVolume",parseFloat(t))},setPlaybackRate(t){return this.$store.dispatch("player/setPlaybackRate",t)},toggleRepeat(){return this.$store.dispatch("player/toggleRepeat")},toggleShuffle(){return this.$store.dispatch("player/toggleShuffle")},toggleFavourite(){return this.favouriteStore.toggle("track",this.track.id)},formatArtists:Y}}),re=ae,ie=(0,y.A)(re,Dt,Et,!1,null,"2de10166",null),ne=ie.exports,oe=(0,a.defineComponent)({components:{TopNav:lt,Sidebar:Rt,Player:ne}}),le=oe,ue=(0,y.A)(le,b,k,!1,null,null,null),ce=ue.exports,de=function(){var t=this,e=t._self._c;return e("main",{staticClass:"container-fluid"},[t._t("default")],2)},pe=[],me={},he=(0,y.A)(me,de,pe,!1,null,null,null),fe=he.exports,ye=(0,a.defineComponent)({components:{ErrorToast:g,Default:ce,Fullscreen:fe},computed:{layout(){return this.$route.meta.layout||"Default"}}}),ve=ye,ge=(0,y.A)(ve,n,o,!1,null,null,null),be=ge.exports;const ke=(t,e)=>{const s={};let r;return{use(t,e){return t.install(this,e),this},config:Object.assign(a["default"].config,{globalProperties:a["default"].prototype}),component:a["default"].component.bind(a["default"]),provide(t,e){return s[t]=e,this},mount:(i,n)=>(r||(r=new a["default"]({...e,provide:s,render:e=>e(t)}),r.$mount(i,n)),r)}};var _e=function(t,e){return t("span",{staticClass:"bg-secondary text-white rounded-circle avatar"},[e._t("default")],2)},xe=[],we={},Ce=(0,y.A)(we,_e,xe,!0,null,"22f79810",null),Ae=Ce.exports,Se=function(t,e){return t("div",[e.props.loading?t("div",{staticClass:"d-flex justify-content-center"},[t("span",{staticClass:"spinner-border"})]):e._t("default")],2)},Pe=[],Ie={},Te=(0,y.A)(Ie,Se,Pe,!0,null,null,null),$e=Te.exports,Me=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",{on:{contextmenu:t.showContextMenu}},[t._t("default"),t.$slots["context-menu"]?e("b-dropdown",{ref:"dropdown",style:{position:"absolute",left:`${t.left}px`,top:`${t.top}px`},attrs:{"toggle-class":"p-0 border-0","no-caret":"",lazy:""},on:{hide:t.hide}},[t._t("context-menu")],2):t._e()],2)},Le=[],qe=(0,a.defineComponent)({data(){return{top:0,left:0,visible:!1}},watch:{visible:{handler(t){a["default"].set(this.$refs.dropdown,"visible",t)}}},methods:{hide(t){t.preventDefault(),this.visible=!1},showContextMenu(t){this.$slots["context-menu"]&&(t.preventDefault(),this.top=t.offsetY,this.left=t.offsetX,this.visible=!0)}}}),Ne=qe,Re=(0,y.A)(Ne,Me,Le,!1,null,null,null),De=Re.exports,Ee=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("BDropdownItemButton",t._g({attrs:{disabled:t.disabled,"button-class":["d-flex justify-content-between text-nowrap",{[`text-${t.variant}`]:t.variant}]}},t.$listeners),[t._t("default",(function(){return[t._v(" "+t._s(t.text)+" ")]})),t.icon?e("Icon",{staticClass:"ml-4",attrs:{icon:t.icon}}):t._e()],2)},Be=[],ze=(0,a.defineComponent)({props:{text:{type:String,default:""},icon:{type:String,default:null},variant:{type:String,default:""},disabled:{type:Boolean,default:!1}}}),Oe=ze,Fe=(0,y.A)(Oe,Ee,Be,!1,null,null,null),Ue=Fe.exports,je=function(t,e){return t("div",{staticClass:"d-flex flex-column align-items-center pt-5"},[t("Icon",{staticClass:"empty-icon",attrs:{icon:"stack"}}),t("div",{staticClass:"mt-4 text-muted"},[e._t("default",(function(){return[e._v(" "+e._s(e.props.label||"Empty")+" ")]}))],2)],1)},Qe=[],Ve={},He=(0,y.A)(Ve,je,Qe,!0,null,"6045f03b",null),Ge=He.exports,Ye=function(t,e){return t("a",{class:[e.data.class,e.data.staticClass],attrs:{href:e.props.href,target:"_blank",rel:"noopener noreferrer"}},[e._t("default")],2)},Ze=[],Je={},We=(0,y.A)(Je,Ye,Ze,!0,null,null,null),Xe=We.exports,Ke=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",{staticClass:"d-flex flex-column flex-md-row align-items-center align-items-md-start position-relative mb-3"},[e("div",{staticClass:"backdrop"}),t.image?e("img",{attrs:{src:t.image}}):e("img",{attrs:{src:s(6910)}}),e("div",{staticClass:"body d-flex flex-column pt-4 pt-md-0 pl-md-4 pb-1 text-center text-md-left"},[t._t("default")],2)])},ts=[],es=s(6910);const ss=(0,a.defineComponent)({props:{image:{type:String,default:null}},computed:{backgroundImage(){return`url('${this.image||es}')`}}}),as=()=>{(0,a.useCssVars)(((t,e)=>({44328486:t.backgroundImage})))},rs=ss.setup;ss.setup=rs?(t,e)=>(as(),rs(t,e)):as;var is=ss,ns=is,os=(0,y.A)(ns,Ke,ts,!1,null,"66ec89d6",null),ls=os.exports,us=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("svg",t._b({staticClass:"bi icon",attrs:{xmlns:"http://www.w3.org/2000/svg",role:"img",focusable:"false","aria-hidden":"true",width:"1em",height:"1em",fill:"currentColor",preserveAspectRatio:"xMidYMid meet",viewBox:"0 0 16 16"},domProps:{innerHTML:t._s(t.path)}},"svg",t.$attrs,!1))},cs=[],ds=s(626),ps=s(9266),ms=s(2802),hs=s(8235),fs=s(9232),ys=s(4197),vs=s(1814),gs=s(1888),bs=s(8406),ks=s(9818),_s=s(8796),xs=s(6234),ws=s(6956),Cs=s(3234),As=s(7004),Ss=s(6904),Ps=s(5959),Is=s(8482),Ts=s(5423),$s=s(9968),Ms=s(3294),Ls=s(4673),qs=s(5038),Ns=s(7539),Rs=s(5863),Ds=s(113),Es=s(6638),Bs=s(9090),zs=s(6150),Os=s(2150),Fs=s(134);const Us={"arrow-up-down":ds.A.body,check:ps.A.body,"chevron-right":ms.A.body,discover:hs.A.body,download:fs.A.body,edit:ys.A.body,files:vs.A.body,folder:gs.A.body,heart:bs.A.body,"heart-fill":ks.A.body,library:_s.A.body,link:xs.A.body,list:ws.A.body,mute:Cs.A.body,nav:As.A.body,pause:Ss.A.body,person:Ps.A.body,play:Is.A.body,playlist:Ts.A.body,plus:$s.A.body,podcast:Ms.A.body,radio:Ls.A.body,refresh:qs.A.body,repeat:Ns.A.body,shuffle:Rs.A.body,"skip-end":Ds.A.body,"skip-start":Es.A.body,stack:Bs.A.body,"three-dots-vertical":zs.A.body,volume:Os.A.body,x:Fs.A.body};var js=(0,a.defineComponent)({props:{icon:{type:String,required:!0}},computed:{path(){return this.icon in Us?Us[this.icon]:(console.warn(`Unknown icon '${this.icon}'`),"")}}}),Qs=js,Vs=(0,y.A)(Qs,us,cs,!1,null,null,null),Hs=Vs.exports,Gs=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("infinite-loading",{ref:"inf",attrs:{"force-use-infinite-wrapper":""},on:{infinite:t.loadMore}},[e("template",{slot:"spinner"},[e("div",{staticClass:"d-flex justify-content-center my-4"},[e("span",{staticClass:"spinner-border"})])]),e("template",{slot:"no-more"},[e("span")]),e("template",{slot:"no-results"},[e("span")])],2)},Ys=[],Zs=s(2252),Js=s.n(Zs),Ws=(0,a.defineComponent)({components:{InfiniteLoading:Js()},props:{loading:{type:Boolean,required:!0},hasMore:{type:Boolean,required:!0}},watch:{loading:{handler(t){this.hasMore?t||this.$refs.inf.stateChanger.loaded():this.$refs.inf.stateChanger.complete()}},hasMore:{handler(t){t||this.$refs.inf.stateChanger.complete()}}},methods:{loadMore(){this.$emit("load-more")}}}),Xs=Ws,Ks=(0,y.A)(Xs,Gs,Ys,!1,null,null,null),ta=Ks.exports,ea=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("b-dropdown",{attrs:{"no-caret":"",boundary:"window",variant:t.variant,"toggle-class":"link"===t.variant?"p-0":"px-1",disabled:t.disabled,lazy:""},scopedSlots:t._u([{key:"button-content",fn:function(){return[e("Icon",{attrs:{icon:"three-dots-vertical"}})]},proxy:!0}])},[t._t("default")],2)},sa=[],aa=(0,a.defineComponent)({props:{disabled:{type:Boolean,default:!1},variant:{type:String,default:"link"}}}),ra=aa,ia=(0,y.A)(ra,ea,sa,!1,null,null,null),na=ia.exports,oa=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("VueSlider",t._b({attrs:{value:t.value,min:t.min,max:t.max,interval:t.step,"tooltip-formatter":t.formatter},on:{change:t.onInput}},"VueSlider",t.$attrs,!1))},la=[],ua=(0,a.defineComponent)({components:{VueSlider:Ft()},props:{value:{type:Number,required:!0},min:{type:Number,required:!0},max:{type:Number,required:!0},step:{type:Number,required:!0},percent:{type:Boolean,default:!1}},methods:{onInput(t){this.$emit("input",t)},formatter(t){return this.percent?`${Math.round(100*(t-this.min)/(this.max-this.min))}%`:`${t}`}}}),ca=ua,da=(0,y.A)(ca,oa,la,!1,null,"1a7198d4",null),pa=da.exports,ma=function(t,e){return t("div",{class:["tiles",e.props.square?"tiles-square":"tiles-rect",{"tiles-hs":e.props.allowHScroll}]},[e._t("default")],2)},ha=[],fa=(0,a.defineComponent)({props:{square:{type:Boolean,default:!1},allowHScroll:{type:Boolean,default:!1}}}),ya=fa,va=(0,y.A)(ya,ma,ha,!0,null,null,null),ga=va.exports,ba=function(t,e){return t("div",e._g(e._b({staticClass:"tile card"},"div",e.data.attrs,!1),e.data.on),[t("ContextMenu",{staticClass:"tile-img",scopedSlots:e._u([{key:"context-menu",fn:function(){return[e._t("context-menu")]},proxy:!0}],null,!0)},[t("router-link",{attrs:{to:e.props.to}},[e.props.image?t("img",{attrs:{src:e.props.image}}):t("img",{attrs:{src:s(6910)}})])],1),t("div",{staticClass:"card-body"},[t("div",{staticClass:"text-truncate font-weight-bold"},[e._t("title",(function(){return[t("router-link",{attrs:{to:e.props.to}},[e._v(" "+e._s(e.props.title)+" ")])]}))],2),t("div",{staticClass:"text-truncate text-muted"},[e._t("text",(function(){return[e._v(" "+e._s(e.props.text)+" ")]}))],2)])],1)},ka=[],_a={},xa=(0,y.A)(_a,ba,ka,!0,null,null,null),wa=xa.exports,Ca=s(5532),Aa=s(5378),Sa=s(934),Pa=s(9656),Ia=s(2493),Ta=s(3488),$a=s(6917);const Ma={Avatar:Ae,BButton:Ca.P,BDropdown:Aa.U,BDropdownDivider:Sa.f,BDropdownItem:Pa.H,BDropdownItemButton:Ia.N,BDropdownText:Ta.P,BModal:$a.i,ContentLoader:$e,ContextMenu:De,ContextMenuItem:Ue,EmptyIndicator:Ge,ExternalLink:Xe,Hero:ls,Icon:Hs,InfiniteLoader:ta,OverflowMenu:na,Slider:pa,Tiles:ga,Tile:wa};var La=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",{staticClass:"row align-items-center h-100 mt-5"},[t.displayForm?e("div",{staticClass:"mx-auto card",staticStyle:{width:"22rem"}},[e("b-overlay",{attrs:{rounded:"",show:t.busy,opacity:"0.1"}},[e("div",{staticClass:"card-body"},[e("form",{on:{submit:function(e){return e.preventDefault(),t.login.apply(null,arguments)}}},[e("div",{staticClass:"d-flex mb-2"},[e("Logo",{staticClass:"mx-auto"})],1),t.config.serverUrl?t._e():e("div",{staticClass:"form-group"},[e("label",[t._v("Server")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.server,expression:"server"}],staticClass:"form-control",class:{"is-invalid":t.hasError},attrs:{name:"server",type:"text"},domProps:{value:t.server},on:{input:function(e){e.target.composing||(t.server=e.target.value)}}})]),e("div",{staticClass:"form-group"},[e("label",[t._v("Username")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.username,expression:"username"}],staticClass:"form-control",class:{"is-invalid":t.hasError},attrs:{name:"username",type:"text"},domProps:{value:t.username},on:{input:function(e){e.target.composing||(t.username=e.target.value)}}})]),e("div",{staticClass:"form-group"},[e("label",[t._v("Password")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.password,expression:"password"}],staticClass:"form-control",class:{"is-invalid":t.hasError},attrs:{name:"password",type:"password"},domProps:{value:t.password},on:{input:function(e){e.target.composing||(t.password=e.target.value)}}})]),null!=t.error?e("div",{staticClass:"alert alert-danger"},[t._v(" Could not log in. ("+t._s(t.error.message)+") ")]):t._e(),e("button",{staticClass:"btn btn-primary btn-block",attrs:{disabled:t.busy},on:{click:t.login}},[e("span",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"spinner-border spinner-border-sm"}),t._v(" Log in ")])])])])],1):e("div",{staticClass:"mx-auto"},[e("span",{staticClass:"spinner-border"})])])},qa=[],Na=s(7228),Ra=(0,a.defineComponent)({components:{BOverlay:Na.n,Logo:T},props:{returnTo:{type:String,required:!0}},setup(){return{store:p(),auth:at()}},data(){return{server:"https://play.thmusic.top",username:"test",password:"test",busy:!1,error:null,displayForm:!1}},computed:{hasError(){return null!==this.error},config:()=>X},async created(){this.server=this.auth.server||this.server,this.username=this.auth.username||this.username;const t=await this.auth.autoLogin();t?(this.store.setLoginSuccess(this.username,this.server),await this.$router.replace(this.returnTo)):this.displayForm=!0},methods:{login(){this.error=null,this.busy=!0,this.auth.loginWithPassword(this.server,this.username,this.password).then((()=>{this.store.setLoginSuccess(this.username,this.server),this.$router.replace(this.returnTo)})).catch((t=>{this.error=t})).finally((()=>{this.busy=!1}))}}}),Da=Ra,Ea=(0,y.A)(Da,La,qa,!1,null,null,null),Ba=Ea.exports,za=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",[e("div",{staticClass:"d-flex justify-content-between align-items-center mb-2"},[e("h1",{staticClass:"mb-0"},[t._v(" 正在播放中 ")]),e("div",[e("b-button",{staticClass:"mr-2",attrs:{variant:"link"},on:{click:t.shuffle}},[e("Icon",{attrs:{icon:"shuffle"}}),t._v(" 随机播放 ")],1),e("b-button",{attrs:{variant:"link"},on:{click:t.clear}},[e("Icon",{attrs:{icon:"x"}}),t._v(" 清空列表 ")],1)],1)]),t.tracks.length>0?e("BaseTable",[e("BaseTableHead",[e("th",{staticClass:"text-left d-none d-lg-table-cell"},[t._v(" 艺术家 ")]),e("th",{staticClass:"text-left d-none d-md-table-cell"},[t._v(" 专辑 ")]),e("th",{staticClass:"text-right d-none d-md-table-cell"},[t._v(" 年份 ")])]),e("tbody",t._l(t.tracks,(function(s,a){return e("tr",{key:a,class:{active:a===t.queueIndex},attrs:{draggable:!0},on:{dragstart:function(e){return t.dragstart(s.id,e)},click:function(e){return t.play(a)}}},[e("CellTrackNumber",{attrs:{active:a===t.queueIndex&&t.isPlaying,value:s.track}}),e("CellTitle",{attrs:{track:s}}),e("CellArtist",{attrs:{track:s}}),e("CellAlbum",{attrs:{track:s}}),e("CellDuration",{attrs:{track:s}}),e("CellActions",{attrs:{track:s}},[e("b-dropdown-divider"),e("ContextMenuItem",{attrs:{icon:"x",variant:"danger"},on:{click:function(e){return t.remove(a)}}},[t._v(" 移除 ")])],1)],1)})),0)],1):e("EmptyIndicator")],1)},Oa=[],Fa=function(t,e){return t("table",{staticClass:"table table-hover table-borderless table-numbered"},[e._t("default")],2)},Ua=[],ja={},Qa=(0,y.A)(ja,Fa,Ua,!0,null,null,null),Va=Qa.exports,Ha=function(t,e){return t("thead",[t("tr",[t("th",[e._v("#")]),t("th",{staticClass:"text-left"},[e._v(" 序号 ")]),e._t("default"),t("th",{staticClass:"text-right"},[e._v(" 操作 ")])],2)])},Ga=[],Ya={},Za=(0,y.A)(Ya,Ha,Ga,!0,null,null,null),Ja=Za.exports,Wa=function(t,e){return t("td",[t("button",[t("Icon",{staticClass:"icon",attrs:{icon:e.props.active?"pause":"play"}}),t("span",{staticClass:"number"},[e._v(e._s(e.props.value||"-"))])],1)])},Xa=[],Ka={},tr=(0,y.A)(Ka,Wa,Xa,!0,null,null,null),er=tr.exports,sr=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("td",{staticClass:"text-right d-none d-md-table-cell"},[t._v(" "+t._s(t.duration)+" ")])},ar=[],rr=(0,a.defineComponent)({props:{track:{type:Object,required:!0}},setup(t){return{duration:t.track.duration?J(t.track.duration):""}}}),ir=rr,nr=(0,y.A)(ir,sr,ar,!1,null,null,null),or=nr.exports,lr=function(t,e){return t("td",{staticClass:"d-none d-md-table-cell"},[e.props.track.albumId?[t("router-link",{attrs:{to:{name:"album",params:{id:e.props.track.albumId}}},nativeOn:{click:function(t){t.stopPropagation()}}},[e._v(" "+e._s(e.props.track.album)+" ")])]:[e._v(" "+e._s(e.props.track.album)+" ")]],2)},ur=[],cr={},dr=(0,y.A)(cr,lr,ur,!0,null,null,null),pr=dr.exports,mr=function(t,e){return t("td",{staticClass:"d-none d-lg-table-cell"},[e._l(e.props.track.artists,(function(s,a){return[a>0?t("span",{key:s.id},[e._v(", ")]):e._e(),s.id?t("router-link",{key:`${s.id}-link`,attrs:{to:{name:"artist",params:{id:s.id}}}},[e._v(" "+e._s(s.name)+" ")]):[e._v(" "+e._s(s.name)+" ")]]}))],2)},hr=[],fr={},yr=(0,y.A)(fr,mr,hr,!0,null,null,null),vr=yr.exports,gr=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("td",[t._t("default",(function(){return[t._v(t._s(t.track.title))]})),t.track.description?e("div",{staticClass:"text-muted"},[e("small",[t._v(t._s(t.track.description))])]):t.track.artists.length?e("div",{staticClass:"d-lg-none text-muted"},[e("small",[t._v(t._s(t.formatArtists(t.track.artists)))])]):t._e()],2)},br=[],kr=(0,a.defineComponent)({props:{track:{type:Object,required:!0}},methods:{formatArtists:Y}}),_r=kr,xr=(0,y.A)(_r,gr,br,!1,null,null,null),wr=xr.exports,Cr=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("td",{staticClass:"text-right",on:{click:function(t){t.stopPropagation()}}},[e("OverflowMenu",[t.track.isUnavailable?t._e():e("ContextMenuItem",{attrs:{icon:"plus"},on:{click:function(e){return t.setNextInQueue()}}},[t._v(" 插入列表下一首 ")]),t.track.isUnavailable?t._e():e("ContextMenuItem",{attrs:{icon:"plus"},on:{click:function(e){return t.addToQueue()}}},[t._v(" 插入列表末端 ")]),t.track.isStream?t._e():e("ContextMenuItem",{attrs:{icon:"plus"},on:{click:function(e){t.showPlaylistSelect=!0}}},[t._v(" 添加到播放列表 ")]),t.track.isStream?t._e():e("ContextMenuItem",{attrs:{icon:"download"},on:{click:function(e){return t.download()}}},[t._v(" 下载 ")]),t._t("default",null,{item:t.track})],2),e("b-modal",{attrs:{title:"Add to playlist","ok-only":"","ok-variant":"secondary","ok-title":"Cancel",size:"md"},scopedSlots:t._u([{key:"modal-header-close",fn:function(){return[e("Icon",{attrs:{icon:"x"}})]},proxy:!0}]),model:{value:t.showPlaylistSelect,callback:function(e){t.showPlaylistSelect=e},expression:"showPlaylistSelect"}},[e("div",{staticClass:"list-group list-group-flush"},t._l(t.playlistStore.playlists,(function(s){return e("button",{key:s.id,staticClass:"list-group-item list-group-item-action text-truncate",attrs:{type:"button"},on:{click:function(e){return t.addToPlaylist(s.id)}}},[t._v(" "+t._s(s.name)+" ")])})),0)])],1)},Ar=[],Sr=(0,a.defineComponent)({props:{track:{type:Object,required:!0}},setup(){return{favouriteStore:Ht(),playlistStore:gt()}},data(){return{showPlaylistSelect:!1}},computed:{isFavourite(){return!!this.favouriteStore.tracks[this.track.id]}},methods:{toggleFavourite(){return this.favouriteStore.toggle("track",this.track.id)},download(){window.location.href=this.$api.getDownloadUrl(this.track.id)},setNextInQueue(){return this.$store.dispatch("player/setNextInQueue",[this.track])},addToQueue(){return this.$store.dispatch("player/addToQueue",[this.track])},addToPlaylist(t){return this.showPlaylistSelect=!1,this.playlistStore.addTracks(t,[this.track.id])}}}),Pr=Sr,Ir=(0,y.A)(Pr,Cr,Ar,!1,null,null,null),Tr=Ir.exports,$r=(0,a.defineComponent)({components:{CellActions:Tr,CellTitle:wr,CellArtist:vr,CellAlbum:pr,CellDuration:or,CellTrackNumber:er,BaseTableHead:Ja,BaseTable:Va},computed:{isPlaying(){return this.$store.getters["player/isPlaying"]},tracks(){return this.$store.state.player.queue},queueIndex(){return this.$store.state.player.queueIndex}},methods:{play(t){return t===this.queueIndex?this.$store.dispatch("player/playPause"):this.$store.dispatch("player/playTrackListIndex",{index:t})},dragstart(t,e){e.dataTransfer.setData("application/x-track-id",t)},remove(t){return this.$store.commit("player/removeFromQueue",t)},clear(){return this.$store.commit("player/clearQueue")},shuffle(){return this.$store.commit("player/shuffleQueue")}}}),Mr=$r,Lr=(0,y.A)(Mr,za,Oa,!1,null,null,null),qr=Lr.exports,Nr=function(){var t=this,e=t._self._c;t._self._setupProxy;return t.loading?t._e():e("div",t._l(t.sections,(function(s){return e("div",{key:s.key,staticClass:"mb-4"},[t.result[s.key].length>0?[e("h1",[t._v(" "+t._s(s.name)+" "),e("router-link",{staticClass:"text-muted",attrs:{to:{name:"albums",params:{sort:s.key}}}},[e("Icon",{attrs:{icon:"chevron-right"}})],1)],1),e("AlbumList",{attrs:{items:t.result[s.key],"allow-h-scroll":""}})]:t._e()],2)})),0)},Rr=[],Dr=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("Tiles",{attrs:{square:"","allow-h-scroll":t.allowHScroll}},t._l(t.items,(function(s){return e("Tile",{key:s.id,attrs:{image:s.image,to:{name:"album",params:{id:s.id}},title:s.name,draggable:!0},on:{dragstart:function(e){return t.dragstart(s.id,e)}},scopedSlots:t._u([{key:"text",fn:function(){return[t._l(s.artists,(function(s,a){return[a>0?e("span",{key:s.id,staticClass:"text-muted"},[t._v(", ")]):t._e(),e("router-link",{key:`${s.id}-link`,staticClass:"text-muted",attrs:{to:{name:"artist",params:{id:s.id}}}},[t._v(t._s(s.name))])]}))]},proxy:!0},{key:"context-menu",fn:function(){return[e("ContextMenuItem",{attrs:{icon:"play"},on:{click:function(e){return t.playNow(s.id)}}},[t._v(" 播放 ")]),e("ContextMenuItem",{attrs:{icon:"plus"},on:{click:function(e){return t.playNext(s.id)}}},[t._v(" Play next ")]),e("ContextMenuItem",{attrs:{icon:"plus"},on:{click:function(e){return t.playLater(s.id)}}},[t._v(" Add to queue ")]),e("ContextMenuItem",{attrs:{icon:t.favourites[s.id]?"heart-fill":"heart"},on:{click:function(e){return t.toggleFavourite(s.id)}}},[t._v(" Favourite ")])]},proxy:!0}],null,!0)})})),1)},Er=[],Br=(0,a.defineComponent)({props:{items:{type:Array,required:!0},allowHScroll:{type:Boolean,default:!1}},setup(){return{favouriteStore:Ht()}},computed:{favourites(){return this.favouriteStore.albums}},methods:{async playNow(t){const e=await this.$api.getAlbumDetails(t);return this.$store.dispatch("player/playTrackList",{tracks:e.tracks})},async playNext(t){const e=await this.$api.getAlbumDetails(t);return this.$store.dispatch("player/setNextInQueue",e.tracks)},async playLater(t){const e=await this.$api.getAlbumDetails(t);return this.$store.dispatch("player/addToQueue",e.tracks)},toggleFavourite(t){return this.favouriteStore.toggle("album",t)},dragstart(t,e){e.dataTransfer.setData("application/x-album-id",t)}}}),zr=Br,Or=(0,y.A)(zr,Dr,Er,!1,null,null,null),Fr=Or.exports,Ur=(0,a.defineComponent)({components:{AlbumList:Fr},data(){return{loading:!0,result:{"recently-added":[],"recently-played":[],"most-played":[],random:[]}}},computed:{sections(){return[{name:"最近添加",key:"recently-added"},{name:"最近播放",key:"recently-played"},{name:"最多播放",key:"most-played"},{name:"随机专辑",key:"random"}]}},created(){const t=18;this.$api.getAlbums("recently-added",t).then((t=>{this.result["recently-added"]=t,this.loading=!1})),this.$api.getAlbums("recently-played",t).then((t=>{this.result["recently-played"]=t})),this.$api.getAlbums("most-played",t).then((t=>{this.result["most-played"]=t})),this.$api.getAlbums("random",50).then((t=>{this.result.random=t}))}}),jr=Ur,Qr=(0,y.A)(jr,Nr,Rr,!1,null,null,null),Vr=Qr.exports,Hr=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("ContentLoader",{attrs:{loading:null==t.item},scopedSlots:t._u([{key:"default",fn:function(){return[e("Hero",{attrs:{image:t.item.image}},[e("h1",[t._v(" "+t._s(t.item.name)+" ")]),e("div",{staticClass:"mb-3"},[e("strong",[t._v(t._s(t.item.albumCount))]),t._v(" 专辑 • "),e("strong",[t._v(t._s(t.item.trackCount))]),t._v(" 歌曲 "),t.item.genres.length>0?e("div",t._l(t.item.genres,(function({name:s},a){return e("span",{key:s},[a>0?e("span",[t._v("•")]):t._e(),e("router-link",{attrs:{to:{name:"genre",params:{id:s}}}},[t._v(" "+t._s(s)+" ")])],1)})),0):t._e()]),t.item.description||t.item.lastFmUrl||t.item.musicBrainzUrl?e("OverflowFade",{staticClass:"mb-3"},[t._v(" "+t._s(t.item.description)+" "),t.item.lastFmUrl?e("ExternalLink",{attrs:{href:t.item.lastFmUrl}},[t._v(" Last.fm "),e("Icon",{attrs:{icon:"link"}})],1):t._e(),t._v(". "),t.item.musicBrainzUrl?e("ExternalLink",{attrs:{href:t.item.musicBrainzUrl}},[t._v(" MusicBrainz "),e("Icon",{attrs:{icon:"link"}})],1):t._e()],1):t._e(),e("div",{staticClass:"text-nowrap"},[e("b-button",{staticClass:"mr-2",attrs:{variant:"secondary",disabled:0===t.item.topTracks.length},on:{click:t.playNow}},[e("Icon",{attrs:{icon:"play"}}),t._v(" 播放 ")],1),e("b-button",{attrs:{variant:"secondary",disabled:0===t.item.topTracks.length},on:{click:t.shuffleNow}},[e("Icon",{attrs:{icon:"shuffle"}}),t._v(" 随机播放 ")],1)],1)],1),t.item.topTracks.length>0?[e("div",{staticClass:"d-flex justify-content-between mt-5 mb-2"},[e("h3",{staticClass:"my-0"},[t._v(" Top tracks ")]),e("router-link",{attrs:{to:{name:"artist-tracks",params:{id:t.id}}}},[t._v(" View all ")])],1),e("TrackList",{attrs:{tracks:t.item.topTracks,"no-artist":""}})]:t._e(),t.albums.length>0?[e("div",{staticClass:"d-flex justify-content-between mt-5 mb-2"},[e("h3",{staticClass:"my-0"},[t._v(" 专辑列表 ")]),e("b-button",{staticClass:"p-0",attrs:{variant:"link"},on:{click:t.toggleAlbumSortOrder}},[e("Icon",{attrs:{icon:"arrow-up-down"}})],1)],1),e("AlbumList",{attrs:{items:t.albums}})]:t._e(),t.item.similarArtist.length>0?[e("h3",{staticClass:"mt-5"},[t._v(" 相似艺术家 ")]),e("ArtistList",{attrs:{items:t.item.similarArtist}})]:t._e()]},proxy:!0}])})},Gr=[],Yr=function(t,e){return t("Tiles",e._l(e.props.items,(function(s){return t("Tile",{key:s.id,attrs:{to:{name:"artist",params:{id:s.id}},title:s.name,image:s.image},scopedSlots:e._u([{key:"text",fn:function(){return[t("strong",[e._v(e._s(s.albumCount))]),e._v(" 专辑 ")]},proxy:!0}],null,!0)})})),1)},Zr=[],Jr={},Wr=(0,y.A)(Jr,Yr,Zr,!0,null,null,null),Xr=Wr.exports,Kr=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("BaseTable",[e("BaseTableHead",[t.noArtist?t._e():e("th",{staticClass:"text-left d-none d-lg-table-cell"},[t._v(" 艺术家 ")]),t.noAlbum?t._e():e("th",{staticClass:"text-left d-none d-md-table-cell"},[t._v(" 专辑 ")]),t.noDuration?t._e():e("th",{staticClass:"text-right d-none d-md-table-cell"},[t._v(" 年份 ")])]),e("tbody",t._l(t.tracks,(function(s,a){return e("tr",{key:a,class:{active:s.id===t.playingTrackId},attrs:{draggable:!0},on:{dragstart:function(e){return t.dragstart(s,e)},click:function(e){return t.play(a)}}},[e("CellTrackNumber",{attrs:{active:s.id===t.playingTrackId&&t.isPlaying,value:s.track||a+1}}),e("CellTitle",{attrs:{track:s}}),t.noArtist?t._e():e("CellArtist",{attrs:{track:s}}),t.noAlbum?t._e():e("CellAlbum",{attrs:{track:s}}),t.noDuration?t._e():e("CellDuration",{attrs:{track:s}}),e("CellActions",{attrs:{track:s}},[t._t("context-menu",null,{index:a,item:s})],2)],1)})),0)],1)},ti=[],ei=(0,a.defineComponent)({components:{BaseTableHead:Ja,BaseTable:Va,CellTitle:wr,CellActions:Tr,CellTrackNumber:er,CellAlbum:pr,CellArtist:vr,CellDuration:or},props:{tracks:{type:Array,required:!0},noAlbum:{type:Boolean,default:!1},noArtist:{type:Boolean,default:!1},noDuration:{type:Boolean,default:!1}},computed:{isPlaying(){return this.$store.getters["player/isPlaying"]},playingTrackId(){return this.$store.getters["player/trackId"]}},methods:{play(t){return this.tracks[t].id===this.playingTrackId?this.$store.dispatch("player/playPause"):this.$store.dispatch("player/playTrackList",{index:t,tracks:this.tracks})},dragstart(t,e){t.isStream||e.dataTransfer.setData("application/x-track-id",t.id)}}}),si=ei,ai=(0,y.A)(si,Kr,ti,!1,null,null,null),ri=ai.exports,ii=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",{ref:"el",staticClass:"el",on:{scroll:t.updateScrollPosition}},[t._t("default")],2)},ni=[];const oi=(0,a.defineComponent)({setup(){const t=(0,a.ref)(null),e=(0,a.ref)(!0),s=(0,a.ref)(!0);function r(){s.value=t.value.scrollHeight-t.value.scrollTop-t.value.clientHeight<1,e.value=t.value.scrollTop<1}const i=(0,a.computed)((()=>e.value?"0":"2em")),n=(0,a.computed)((()=>s.value?"0":"2em")),o=new ResizeObserver((()=>{r()}));return(0,a.onMounted)((()=>{o.observe(t.value)})),(0,a.onUnmounted)((()=>{o.disconnect()})),{el:t,updateScrollPosition:r,maskTop:i,maskBottom:n}}}),li=()=>{(0,a.useCssVars)(((t,e)=>({"0d665b20":t.maskTop,"34292f30":t.maskBottom})))},ui=oi.setup;oi.setup=ui?(t,e)=>(li(),ui(t,e)):li;var ci=oi,di=ci,pi=(0,y.A)(di,ii,ni,!1,null,"31003db6",null),mi=pi.exports,hi=(0,a.defineComponent)({components:{AlbumList:Fr,ArtistList:Xr,OverflowFade:mi,TrackList:ri},props:{id:{type:String,required:!0}},setup(){return{mainStore:p(),favouriteStore:Ht()}},data(){return{item:null}},computed:{isFavourite(){return!!this.favouriteStore.artists[this.id]},albums(){return(0,vt.A)(this.item?.albums??[],"year",this.mainStore.artistAlbumSortOrder)}},watch:{id:{immediate:!0,async handler(t){this.item=null,this.item=await this.$api.getArtistDetails(t)}}},methods:{playNow(){return this.$store.dispatch("player/playNow",{tracks:this.item.topTracks})},shuffleNow(){return this.$store.dispatch("player/shuffleNow",{tracks:this.item.topTracks})},toggleFavourite(){return this.favouriteStore.toggle("artist",this.id)},toggleAlbumSortOrder(){this.mainStore.toggleArtistAlbumSortOrder()}}}),fi=hi,yi=(0,y.A)(fi,Hr,Gr,!1,null,null,null),vi=yi.exports,gi=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",[e("ul",{staticClass:"nav-underlined mb-3"},[e("li",[e("router-link",{attrs:{to:{...t.$route,params:{...t.$route.params,sort:null}}}},[t._v(" 专辑数目排序 ")])],1),e("li",[e("router-link",{attrs:{to:{...t.$route,params:{...t.$route.params,sort:"a-z"}}}},[t._v(" A-Z首字母排序 ")])],1)]),e("ContentLoader",{attrs:{loading:t.loading},scopedSlots:t._u([{key:"default",fn:function(){return[e("ArtistList",{attrs:{items:t.sortedItems}})]},proxy:!0}])})],1)},bi=[],ki=(0,a.defineComponent)({components:{ArtistList:Xr},props:{sort:{type:String,default:null}},data(){return{loading:!0,items:[]}},computed:{sortedItems(){return"a-z"===this.sort?(0,vt.A)(this.items,"name"):(0,vt.A)(this.items,"albumCount","desc")}},async created(){this.items=Object.freeze(await this.$api.getArtists()),this.loading=!1}}),_i=ki,xi=(0,y.A)(_i,gi,bi,!1,null,null,null),wi=xi.exports,Ci=function(){var t=this,e=t._self._c;t._self._setupProxy;return t.album?e("div",[e("Hero",{attrs:{image:t.album.image}},[e("h1",[t._v(" "+t._s(t.album.name)+" ")]),e("p",[t._v(" by "),t._l(t.album.artists,(function(s,a){return[a>0?e("span",{key:s.id,staticClass:"text-muted"},[t._v(", ")]):t._e(),e("router-link",{key:`${s.id}-link`,attrs:{to:{name:"artist",params:{id:s.id}}}},[t._v(t._s(s.name))])]})),t.album.year?e("span",[t._v(" • "+t._s(t.album.year))]):t._e(),t.album.genres.length?e("span",[t._v(" • "),t._l(t.album.genres,(function({name:s},a){return[a>0?e("span",{key:s,staticClass:"text-muted"},[t._v(", ")]):t._e(),e("router-link",{key:`${s}-link`,attrs:{to:{name:"genre",params:{id:s}}}},[t._v(t._s(s))])]}))],2):t._e()],2),e("div",{staticClass:"text-nowrap"},[e("b-button",{staticClass:"mr-2",attrs:{variant:"secondary"},on:{click:t.playNow}},[e("Icon",{attrs:{icon:"play"}}),t._v(" 播放 ")],1),e("b-button",{staticClass:"mr-2",attrs:{variant:"secondary"},on:{click:t.shuffleNow}},[e("Icon",{attrs:{icon:"shuffle"}}),t._v(" 随机播放 ")],1),e("OverflowMenu",{staticClass:"px-1"},[e("ContextMenuItem",{attrs:{icon:"plus"},on:{click:t.setNextInQueue}},[t._v(" 插入列表下一首 ")]),e("ContextMenuItem",{attrs:{icon:"plus"},on:{click:t.addToQueue}},[t._v(" 插入列表末端 ")])],1)],1)]),e("div",{staticClass:"row"},[e("div",{staticClass:"col"},[e("TrackList",{attrs:{tracks:t.album.tracks,"no-album":""}})],1)])],1):t._e()},Ai=[],Si=(0,a.defineComponent)({components:{TrackList:ri},props:{id:{type:String,required:!0}},setup(){return{favouriteStore:Ht()}},data(){return{album:null}},computed:{isFavourite(){return!!this.favouriteStore.albums[this.id]}},async created(){this.album=await this.$api.getAlbumDetails(this.id)},methods:{playNow(){return this.$store.dispatch("player/playNow",{tracks:this.album.tracks})},shuffleNow(){return this.$store.dispatch("player/shuffleNow",{tracks:this.album.tracks})},setNextInQueue(){if(this.album)return this.$store.dispatch("player/setNextInQueue",this.album.tracks)},addToQueue(){if(this.album)return this.$store.dispatch("player/addToQueue",this.album.tracks)},toggleFavourite(){return this.favouriteStore.toggle("album",this.id)}}}),Pi=Si,Ii=(0,y.A)(Pi,Ci,Ai,!1,null,null,null),Ti=Ii.exports,$i=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",[e("ul",{staticClass:"nav-underlined mb-3"},t._l(t.options,(function({value:s,text:a}){return e("li",{key:s},[e("router-link",{attrs:{to:{...t.$route,params:{...t.$route.params,sort:s}}}},[t._v(" "+t._s(a)+" ")])],1)})),0),e("AlbumList",{attrs:{items:t.albums}}),e("InfiniteLoader",{key:t.sort,attrs:{loading:t.loading,"has-more":t.hasMore},on:{"load-more":t.loadMore}})],1)},Mi=[],Li=(0,a.defineComponent)({components:{AlbumList:Fr},props:{sort:{type:String,required:!0}},data(){return{albums:[],loading:!1,offset:0,hasMore:!0}},computed:{options(){return[{text:"最近添加",value:"recently-added"},{text:"最近播放",value:"recently-played"},{text:"最多播放",value:"most-played"},{text:"A-Z排序",value:"a-z"},{text:"随机专辑",value:"random"}]}},watch:{sort:{handler(){this.albums=[],this.offset=0,this.hasMore=!0}}},methods:{loadMore(){return this.loading=!0,this.$api.getAlbums(this.sort,50,this.offset).then((t=>{this.albums.push(...t),this.offset+=t.length,this.hasMore=t.length>0,this.loading=!1}))}}}),qi=Li,Ni=(0,y.A)(qi,$i,Mi,!1,null,null,null),Ri=Ni.exports,Di=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",[e("h1",[t._v(t._s(t.id))]),e("ul",{staticClass:"nav-underlined mb-3"},[e("li",[e("router-link",{attrs:{to:{...t.$route,params:{}}}},[t._v(" Albums ")])],1),e("li",[e("router-link",{attrs:{to:{...t.$route,params:{section:"tracks"}}}},[t._v(" Tracks ")])],1)]),"tracks"===t.section?[e("InfiniteList",{key:"tracks",attrs:{load:t.loadTracks},scopedSlots:t._u([{key:"default",fn:function({items:t}){return[e("TrackList",{attrs:{tracks:t}})]}}],null,!1,1154193652)})]:[e("InfiniteList",{key:"albums",attrs:{load:t.loadAlbums},scopedSlots:t._u([{key:"default",fn:function({items:t}){return[e("AlbumList",{attrs:{items:t}})]}}])})]],2)},Ei=[],Bi=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",[t._t("default",null,{items:t.items}),e("InfiniteLoader",{attrs:{loading:t.loading,"has-more":t.hasMore},on:{"load-more":t.loadMore}})],2)},zi=[],Oi=(0,a.defineComponent)({props:{load:{type:Function,required:!0}},data(){return{items:[],loading:!1,offset:0,hasMore:!0}},methods:{loadMore(){return this.loading=!0,this.load(this.offset).then((t=>{this.items.push(...t),this.offset+=t.length,this.hasMore=t.length>0,this.loading=!1}))}}}),Fi=Oi,Ui=(0,y.A)(Fi,Bi,zi,!1,null,null,null),ji=Ui.exports,Qi=(0,a.defineComponent)({components:{AlbumList:Fr,TrackList:ri,InfiniteList:ji},props:{id:{type:String,required:!0},section:{type:String,default:""}},methods:{loadAlbums(t){return this.$api.getAlbumsByGenre(this.id,50,t)},loadTracks(t){return this.$api.getTracksByGenre(this.id,50,t)}}}),Vi=Qi,Hi=(0,y.A)(Vi,Di,Ei,!1,null,null,null),Gi=Hi.exports,Yi=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",[e("ul",{staticClass:"nav-underlined mb-3"},[e("li",[e("router-link",{attrs:{to:{...t.$route,params:{...t.$route.params,sort:null}}}},[t._v(" Most albums ")])],1),e("li",[e("router-link",{attrs:{to:{...t.$route,params:{...t.$route.params,sort:"a-z"}}}},[t._v(" A-Z ")])],1)]),e("ContentLoader",{attrs:{loading:t.loading},scopedSlots:t._u([{key:"default",fn:function(){return[e("Tiles",t._l(t.sortedItems,(function(s){return e("Tile",{key:s.id,attrs:{to:{name:"genre",params:{id:s.id}},title:s.name,image:s.image},scopedSlots:t._u([{key:"text",fn:function(){return[e("strong",[t._v(t._s(s.albumCount))]),t._v(" albums • "),e("strong",[t._v(t._s(s.trackCount))]),t._v(" tracks ")]},proxy:!0}],null,!0)})})),1)]},proxy:!0}])})],1)},Zi=[],Ji=(0,a.defineComponent)({props:{sort:{type:String,default:null}},data(){return{loading:!0,items:[]}},computed:{sortedItems(){return"a-z"===this.sort?(0,vt.A)(this.items,"name"):(0,vt.A)(this.items,"albumCount","desc")}},async created(){this.items=await this.$api.getGenres(),this.loading=!1}}),Wi=Ji,Xi=(0,y.A)(Wi,Yi,Zi,!1,null,null,null),Ki=Xi.exports,tn=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",[e("ul",{staticClass:"nav-underlined mb-3"},[e("li",[e("router-link",{attrs:{to:{...t.$route,params:{}}}},[t._v(" Albums ")])],1),e("li",[e("router-link",{attrs:{to:{...t.$route,params:{section:"artists"}}}},[t._v(" Artists ")])],1),e("li",[e("router-link",{attrs:{to:{...t.$route,params:{section:"tracks"}}}},[t._v(" Tracks ")])],1)]),e("ContentLoader",{attrs:{loading:null==t.details},scopedSlots:t._u([{key:"default",fn:function(){return["artists"===t.section?[t.details.artists.length>0?e("ArtistList",{attrs:{items:t.details.artists}}):e("EmptyIndicator")]:"tracks"===t.section?[t.details.tracks.length>0?e("TrackList",{attrs:{tracks:t.details.tracks}}):e("EmptyIndicator")]:[t.details.albums.length>0?e("AlbumList",{attrs:{items:t.details.albums}}):e("EmptyIndicator")]]},proxy:!0}])})],1)},en=[],sn=s(9062),an=s(4107),rn=s(4722);class nn extends Error{}class on{constructor(t){(0,O.A)(this,"auth",void 0),(0,O.A)(this,"fetch",void 0),(0,O.A)(this,"clientName",window.origin||"web"),this.auth=t,this.fetch=(t,e)=>{const s=`${this.auth.server}/${t}?${Z({...e,v:"1.15.0",f:"json",c:this.clientName})}&${this.auth.urlParams}`;return window.fetch(s,{method:"GET",headers:{Accept:"application/json"}}).then((t=>{if(t.ok)return t.json();const e=`Request failed with status ${t.status}`;return 501===t.status?Promise.reject(new nn(e)):Promise.reject(new Error(e))})).then((t=>{const e=t["subsonic-response"];if("ok"===e.status)return e;const s=e.error?.message||e.status;throw new Error(s)}))}}async getGenres(){const t=await this.fetch("rest/getGenres",{});return(t.genres.genre||[]).map((t=>({id:t.value,name:t.value,albumCount:t.albumCount??0,trackCount:t.songCount??0}))).sort(((t,e)=>e.albumCount-t.albumCount))}async getAlbumsByGenre(t,e,s=0){const a={type:"byGenre",genre:t,size:e,offset:s},r=await this.fetch("rest/getAlbumList2",a);return(r.albumList2?.album||[]).map(this.normalizeAlbum,this)}async getTracksByGenre(t,e,s=0){const a={genre:t,count:e,offset:s},r=await this.fetch("rest/getSongsByGenre",a);return(r.songsByGenre?.song||[]).map(this.normalizeTrack,this)}async getArtists(){const t=await this.fetch("rest/getArtists");return(t.artists?.index||[]).flatMap((t=>t.artist)).map(this.normalizeArtist,this)}async getAlbums(t,e,s=0){const a={"a-z":"alphabeticalByName","recently-added":"newest","recently-played":"recent","most-played":"frequent",random:"random"}[t],r={type:a,offset:s,size:e},i=await this.fetch("rest/getAlbumList2",r),n=i.albumList2?.album||[];return n.map(this.normalizeAlbum,this)}async getArtistDetails(t){const e=this.fetch("rest/getArtistInfo2",{id:t}).then((t=>t.artistInfo2)),s=await this.fetch("rest/getArtist",{id:t}).then((t=>t.artist)),a=await this.fetch("rest/getTopSongs",{artist:s.name}).then((t=>t.topSongs?.song)),r=await e;return this.normalizeArtist({...s,...r,topSongs:a})}async*getTracksByArtist(t){const e=await this.fetch("rest/getArtist",{id:t}).then((t=>t.artist)),s=(0,vt.A)(e.album||[],(t=>t.year||0),"desc").map((t=>t.id));for(const a of s){const{tracks:t}=await this.getAlbumDetails(a);t&&t.length>0&&(yield t)}}async getAlbumDetails(t){const e={id:t},s=await this.fetch("rest/getAlbum",e);return this.normalizeAlbum(s.album)}async getPlaylists(){const t=await this.fetch("rest/getPlaylists");return(t.playlists?.playlist||[]).map(this.normalizePlaylist,this)}async getPlaylist(t){if("random"===t){const e=await this.getRandomSongs();return{id:t,name:"Random",comment:"",createdAt:"",updatedAt:"",tracks:e,trackCount:e.length,isPublic:!1,isReadOnly:!0}}const e=await this.fetch("rest/getPlaylist",{id:t});return{...this.normalizePlaylist(e.playlist),tracks:(e.playlist.entry||[]).map(this.normalizeTrack,this)}}async createPlaylist(t){return await this.fetch("rest/createPlaylist",{name:t}),this.getPlaylists()}async editPlaylist(t,e,s,a){const r={playlistId:t,name:e,comment:s,public:a};await this.fetch("rest/updatePlaylist",r)}async deletePlaylist(t){await this.fetch("rest/deletePlaylist",{id:t})}async addToPlaylist(t,e){const s={playlistId:t,songIdToAdd:e};await this.fetch("rest/updatePlaylist",s)}async removeFromPlaylist(t,e){const s={playlistId:t,songIndexToRemove:e};await this.fetch("rest/updatePlaylist",s)}async getRandomSongs(){const t={size:200},e=await this.fetch("rest/getRandomSongs",t);return(e.randomSongs?.song||[]).map(this.normalizeTrack,this)}async getFavourites(){const t=await this.fetch("rest/getStarred2");return{albums:(t.starred2?.album||[]).map(this.normalizeAlbum,this),artists:(t.starred2?.artist||[]).map(this.normalizeArtist,this),tracks:(t.starred2?.song||[]).map(this.normalizeTrack,this)}}async addFavourite(t,e){const s={id:"track"===e?t:void 0,albumId:"album"===e?t:void 0,artistId:"artist"===e?t:void 0};await this.fetch("rest/star",s)}async removeFavourite(t,e){const s={id:"track"===e?t:void 0,albumId:"album"===e?t:void 0,artistId:"artist"===e?t:void 0};await this.fetch("rest/unstar",s)}async search(t){const e={query:t},s=await this.fetch("rest/search3",e);return{tracks:(s.searchResult3.song||[]).map(this.normalizeTrack,this),albums:(s.searchResult3.album||[]).map(this.normalizeAlbum,this),artists:(s.searchResult3.artist||[]).map(this.normalizeArtist,this)}}async getRadioStations(){const t=await this.fetch("rest/getInternetRadioStations");return(t?.internetRadioStations?.internetRadioStation||[]).map(((t,e)=>({...t,track:e+1}))).map(this.normalizeRadioStation,this)}async addRadioStation(t,e,s){const a={name:t??"",streamUrl:e,homepageUrl:""===s?.trim()?void 0:s};return await this.fetch("rest/createInternetRadioStation",a),await this.getRadioStations()}async updateRadioStation(t){const e={id:t.id.replace("radio-",""),name:t.title??"",streamUrl:t.url,homepageUrl:""===t.description?.trim()?void 0:t.description};return await this.fetch("rest/updateInternetRadioStation",e),await this.getRadioStations()}async deleteRadioStation(t){return this.fetch("rest/deleteInternetRadioStation",{id:t.replace("radio-","")})}async getPodcasts(){const t=await this.fetch("rest/getPodcasts");return(t?.podcasts?.channel||[]).map(this.normalizePodcast,this)}async getPodcast(t){const e=await this.fetch("rest/getPodcasts",{id:t});return this.normalizePodcast(e?.podcasts?.channel[0])}async addPodcast(t){return this.fetch("rest/createPodcastChannel",{url:t})}async refreshPodcasts(){return this.fetch("rest/refreshPodcasts")}async deletePodcast(t){return this.fetch("rest/deletePodcastChannel",{id:t})}async getDirectory(t){const e=t.split("/"),s=e[0],a=e.length>1?e[e.length-1]:"";if(""===s){const t=await this.fetch("rest/getMusicFolders"),e=t?.musicFolders?.musicFolder??[];return{id:"",name:"",tracks:[],directories:e.map((t=>({id:`${t?.id}`,name:t?.name})))}}if(""===a){const t=await this.fetch("rest/getIndexes",{musicFolderId:s}),e=(t?.indexes?.index??[]).flatMap((t=>[...(t?.artist||[]).map((t=>({id:t.id,name:t.name})))])),a=(t?.indexes?.child??[]).map(this.normalizeTrack,this);return{id:s,name:s,tracks:a,directories:e}}const r=await this.fetch("rest/getMusicDirectory",{id:a}),i=r?.directory?.child??[],n=i.filter((t=>t.isDir)).map((t=>({id:t.id,name:t.title}))),o=i.filter((t=>!t.isDir&&"music"===t.type&&t?.duration>0)).map(this.normalizeTrack,this);return{id:r.directory.id,name:r.directory.name,tracks:o,directories:n}}async scan(){return this.fetch("rest/startScan")}async scrobble(t){return this.fetch("rest/scrobble",{id:t,submission:!0})}async updateNowPlaying(t){return this.fetch("rest/scrobble",{id:t,submission:!1})}normalizeRadioStation(t){return{id:`radio-${t.id}`,title:t.name,description:t.homepageUrl||t.homePageUrl,album:t.name,track:t.track,url:t.streamUrl,duration:0,favourite:!1,isStream:!0,artists:[]}}normalizeTrack(t){return{id:t.id,title:t.title,duration:t.duration,favourite:!!t.starred,track:t.track,album:t.album,albumId:t.albumId,artists:t.artists?.length?t.artists:[{id:t.artistId,name:t.artist}],url:this.getStreamUrl(t.id),image:this.getCoverArtUrl(t)}}normalizeGenres(t){return t.genres?.length?t.genres:t.genre?[{name:t.genre}]:[]}normalizeAlbum(t){return{id:t.id,name:t.name,artists:t.artists?.length?t.artists:[{id:t.artistId,name:t.artist}],image:this.getCoverArtUrl(t),year:t.year||0,favourite:!!t.starred,genres:this.normalizeGenres(t),tracks:(t.song||[]).map(this.normalizeTrack,this)}}normalizeArtist(t){return{id:t.id,name:t.name,description:(t.biography||"").replace(/<a[^>]*>.*?<\/a>/gm,""),genres:(0,sn.A)([...(t.album||[]).flatMap(this.normalizeGenres,this)],"name"),albumCount:t.albumCount,trackCount:(t.album||[]).reduce(((t,e)=>t+(e.songCount||0)),0),favourite:!!t.starred,lastFmUrl:t.lastFmUrl,musicBrainzUrl:t.musicBrainzId?`https://musicbrainz.org/artist/${t.musicBrainzId}`:void 0,albums:(t.album||[]).map(this.normalizeAlbum,this),similarArtist:(t.similarArtist||[]).map(this.normalizeArtist,this),topTracks:(t.topSongs||[]).slice(0,5).map(this.normalizeTrack,this),image:t.coverArt?this.getCoverArtUrl(t):t.artistImageUrl}}normalizePlaylist(t){return{id:t.id,name:t.name||"(Unnamed)",comment:t.comment||"",createdAt:t.created||"",updatedAt:t.changed||"",trackCount:t.songCount,image:t.songCount>0?this.getCoverArtUrl(t):void 0,isPublic:t.public,isReadOnly:!1}}normalizePodcast(t){const e=t.originalImageUrl,s=t.episode||[];return{id:t.id,name:t.title||t.url,description:t.description,image:e,url:t.url,trackCount:s.length,updatedAt:(0,an.A)((0,rn.A)(s,"publishDate")),tracks:s.map(((a,r)=>({id:a.id,title:a.title,duration:a.duration,favourite:!1,track:s.length-r,album:t.title,albumId:void 0,image:e,isPodcast:!0,isUnavailable:"completed"!==a.status||!a.streamId,url:"completed"===a.status&&a.streamId?this.getStreamUrl(a.streamId):void 0,description:a.description,playCount:a.playCount||0,artists:[]})))}}getDownloadUrl(t){const{server:e,urlParams:s}=this.auth;return`${e}/rest/download?id=${t}&v=1.15.0&${s}&c=${this.clientName}`}getCoverArtUrl(t){if(!t.coverArt)return;const{server:e,urlParams:s}=this.auth;return`${e}/rest/getCoverArt?id=${t.coverArt}&v=1.15.0&${s}&c=${this.clientName}&size=300`}getStreamUrl(t){const{server:e,urlParams:s}=this.auth;return`${e}/rest/stream?id=${t}&v=1.15.0&${s}&c=${this.clientName}`}}const ln=Symbol("");function un(){return(0,a.inject)(ln)}function cn(t){const e=new on(t);return Object.assign(e,{install:t=>{t.config.globalProperties.$api=e,t.provide(ln,e)}})}var dn=(0,a.defineComponent)({components:{AlbumList:Fr,ArtistList:Xr,TrackList:ri},props:{section:{type:String,default:""}},setup(){const t=un(),e=Ht(),s=(0,a.ref)(null);return(0,a.watch)((()=>[e]),(async()=>{const a=await t.getFavourites();s.value={albums:a.albums.filter((t=>e.albums[t.id])),artists:a.artists.filter((t=>e.artists[t.id])),tracks:a.tracks.filter((t=>e.tracks[t.id]))}}),{deep:!0,immediate:!0}),{details:s}}}),pn=dn,mn=(0,y.A)(pn,tn,en,!1,null,null,null),hn=mn.exports,fn=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("ContentLoader",{attrs:{loading:null===t.items},scopedSlots:t._u([{key:"default",fn:function(){return[e("div",{staticClass:"d-flex justify-content-between align-items-center mb-2"},[e("h1",{staticClass:"mb-0 mr-2 text-truncate"},[t._v(" Radio ")]),e("b-button",{attrs:{variant:"link",disabled:t.unsupported},on:{click:t.openAddModal}},[e("Icon",{attrs:{icon:"plus"}})],1)],1),t.items.length>0?e("TrackList",{attrs:{tracks:t.items,"no-artist":"","no-album":"","no-duration":""},scopedSlots:t._u([{key:"context-menu",fn:function({item:s}){return[e("ContextMenuItem",{attrs:{icon:"edit"},on:{click:function(e){return t.openEditModal(s)}}},[t._v(" Edit ")]),e("b-dropdown-divider"),e("ContextMenuItem",{attrs:{icon:"x",variant:"danger"},on:{click:function(e){return t.deleteRadioStation(s)}}},[t._v(" Delete ")])]}}],null,!1,1625726372)}):t.unsupported?e("EmptyIndicator",{attrs:{label:"Not supported"}}):e("EmptyIndicator"),e("EditModal",{attrs:{visible:t.modalVisible,item:t.editItem},on:{"update:visible":function(e){t.modalVisible=e},confirm:t.saveRadioStation},scopedSlots:t._u([{key:"title",fn:function({item:e}){return[t._v(" "+t._s(e?.id?"Edit":"Add")+" Radio Station ")]}},{key:"default",fn:function({item:s}){return[e("div",{staticClass:"form-group"},[e("label",[t._v("Name")]),e("input",{directives:[{name:"model",rawName:"v-model",value:s.title,expression:"item.title"}],staticClass:"form-control",attrs:{type:"text"},domProps:{value:s.title},on:{input:function(e){e.target.composing||t.$set(s,"title",e.target.value)}}})]),e("div",{staticClass:"form-group"},[e("label",[t._v("Stream URL")]),e("input",{directives:[{name:"model",rawName:"v-model",value:s.url,expression:"item.url"}],staticClass:"form-control",attrs:{type:"text"},domProps:{value:s.url},on:{input:function(e){e.target.composing||t.$set(s,"url",e.target.value)}}})]),e("div",{staticClass:"form-group"},[e("label",{staticClass:"mb-0"},[t._v("Home Page URL")]),e("input",{directives:[{name:"model",rawName:"v-model",value:s.description,expression:"item.description"}],staticClass:"form-control",attrs:{type:"text"},domProps:{value:s.description},on:{input:function(e){e.target.composing||t.$set(s,"description",e.target.value)}}})])]}}])})]},proxy:!0}])})},yn=[],vn=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("b-modal",{attrs:{"ok-title":"Save",visible:t.visible},on:{ok:t.confirm,change:t.change},scopedSlots:t._u([{key:"modal-header-close",fn:function(){return[e("Icon",{attrs:{icon:"x"}})]},proxy:!0},{key:"modal-title",fn:function(){return[t._t("title",(function(){return[t._v(" "+t._s(t.title)+" ")]}),{item:t.copy})]},proxy:!0}],null,!0)},[t.visible?[t._t("default",null,{item:t.copy})]:t._e()],2)},gn=[],bn=(0,a.defineComponent)({props:{item:{type:Object,default:null},visible:{type:Boolean,required:!0},title:{type:String,default:""}},data(){return{copy:null}},watch:{item:{immediate:!0,handler(t){this.copy={...t}}}},methods:{confirm(){this.$emit("confirm",this.copy)},change(){this.$emit("update:visible",!1)}}}),kn=bn,_n=(0,y.A)(kn,vn,gn,!1,null,null,null),xn=_n.exports,wn=(0,a.defineComponent)({components:{TrackList:ri,ContentLoader:$e,EditModal:xn},data(){return{items:null,unsupported:!1,modalVisible:!1,editItem:{}}},async created(){try{this.items=await this.$api.getRadioStations()}catch(t){if(t instanceof nn)return this.items=[],void(this.unsupported=!0);throw t}},methods:{openAddModal(){this.editItem={},this.modalVisible=!0},openEditModal(t){this.editItem=t,this.modalVisible=!0},deleteRadioStation(t){this.$api.deleteRadioStation(t.id),this.items=this.items.filter((e=>e.id!==t.id))},async saveRadioStation(t){this.editItem={},t.id?this.items=await this.$api.updateRadioStation(t):this.items=await this.$api.addRadioStation(t.title,t.url,t.description)}}}),Cn=wn,An=(0,y.A)(Cn,fn,yn,!1,null,null,null),Sn=An.exports,Pn=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("ContentLoader",{attrs:{loading:null==t.podcast},scopedSlots:t._u([{key:"default",fn:function(){return[e("Hero",{attrs:{image:t.podcast.image}},[e("h1",[t._v(" "+t._s(t.podcast.name)+" ")]),t.podcast.description?e("OverflowFade",{staticClass:"mb-3"},[t._v(" "+t._s(t.podcast.description)+" ")]):t._e(),e("div",{staticClass:"text-nowrap"},[e("b-button",{staticClass:"mr-2",attrs:{variant:"secondary",disabled:0===t.playableTracks.length},on:{click:t.playNow}},[e("Icon",{attrs:{icon:"play"}}),t._v(" Play ")],1),e("b-button",{attrs:{variant:"secondary",disabled:0===t.playableTracks.length},on:{click:t.shuffleNow}},[e("Icon",{attrs:{icon:"shuffle"}}),t._v(" Shuffle ")],1),e("OverflowMenu",{staticClass:"px-1"},[e("ContextMenuItem",{attrs:{icon:"x",variant:"danger"},on:{click:t.deletePodcast}},[t._v(" Delete ")])],1)],1)],1),t.podcast.tracks.length>0?e("BaseTable",[e("BaseTableHead",[e("th",{staticClass:"text-right d-none d-md-table-cell"},[t._v(" Duration ")])]),e("tbody",t._l(t.podcast.tracks,(function(s,a){return e("tr",{key:a,class:{active:s.id===t.playingTrackId,disabled:s.isUnavailable},on:{click:function(e){return t.playTrack(s)}}},[e("CellTrackNumber",{attrs:{active:s.id===t.playingTrackId&&t.isPlaying,value:s.track}}),e("CellTitle",{attrs:{track:s}},[t._v(" "+t._s(s.title)+" "),s.playCount>0?e("Icon",{attrs:{icon:"check"}}):t._e()],1),e("CellDuration",{attrs:{track:s}}),e("CellActions",{attrs:{track:s}})],1)})),0)],1):e("EmptyIndicator")]},proxy:!0}])})},In=[],Tn=(0,a.defineComponent)({components:{BaseTableHead:Ja,BaseTable:Va,CellTitle:wr,CellDuration:or,CellActions:Tr,CellTrackNumber:er,OverflowFade:mi},props:{id:{type:String,required:!0}},data(){return{podcast:null}},computed:{isPlaying(){return this.$store.getters["player/isPlaying"]},playingTrackId(){return this.$store.getters["player/trackId"]},playableTracks(){return this.podcast.tracks.filter((t=>!t.isUnavailable))}},async created(){this.podcast=await this.$api.getPodcast(this.id)},methods:{async playNow(){return this.$store.dispatch("player/playNow",{tracks:this.playableTracks})},async shuffleNow(){return this.$store.dispatch("player/shuffleNow",{tracks:this.playableTracks})},async playTrack(t){if(t.isUnavailable)return;if(t.id===this.playingTrackId)return this.$store.dispatch("player/playPause");const e=this.playableTracks.findIndex((e=>e.id===t.id));return this.$store.dispatch("player/playTrackList",{index:e,tracks:this.playableTracks})},async deletePodcast(){return this.podcast=null,await this.$api.deletePodcast(this.id),this.$router.replace({name:"podcasts"})}}}),$n=Tn,Mn=(0,y.A)($n,Pn,In,!1,null,null,null),Ln=Mn.exports,qn=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",[e("div",{staticClass:"d-flex justify-content-between align-items-center mb-3"},[e("ul",{staticClass:"nav-underlined"},[e("li",[e("router-link",{attrs:{to:{...t.$route,params:{...t.$route.params,sort:null}}}},[t._v(" Recently updated ")])],1),e("li",[e("router-link",{attrs:{to:{...t.$route,params:{...t.$route.params,sort:"a-z"}}}},[t._v(" A-Z ")])],1)]),e("div",[e("b-button",{staticClass:"mr-2",attrs:{variant:"link"},on:{click:function(e){t.showAddModal=!0}}},[e("Icon",{attrs:{icon:"plus"}})],1),e("b-button",{attrs:{icon:"refresh",variant:"link"},on:{click:function(e){return t.refresh()}}},[e("Icon",{attrs:{icon:"refresh"}})],1)],1)]),e("ContentLoader",{attrs:{loading:null===t.items},scopedSlots:t._u([{key:"default",fn:function(){return[t.items.length>0?e("Tiles",{attrs:{square:""}},t._l(t.sortedItems,(function(s){return e("Tile",{key:s.id,attrs:{image:s.image,to:{name:"podcast",params:{id:s.id}},title:s.name},scopedSlots:t._u([{key:"text",fn:function(){return[e("strong",[t._v(t._s(s.trackCount))]),t._v(" episodes ")]},proxy:!0}],null,!0)})})),1):t.unsupported?e("EmptyIndicator",{attrs:{label:"Not supported"}}):e("EmptyIndicator")]},proxy:!0}])}),e("AddPodcastModal",{attrs:{visible:t.showAddModal},on:{"update:visible":function(e){t.showAddModal=e},confirm:t.add}})],1)},Nn=[],Rn=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("b-modal",{attrs:{visible:t.visible},on:{ok:t.confirm,change:t.change},scopedSlots:t._u([{key:"modal-header-close",fn:function(){return[e("Icon",{attrs:{icon:"x"}})]},proxy:!0},{key:"modal-title",fn:function(){return[t._v(" Add podcast ")]},proxy:!0},{key:"modal-ok",fn:function(){return[t._v(" Add ")]},proxy:!0}])},[e("div",{staticClass:"form-group"},[e("label",[t._v("URL")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.url,expression:"url"}],staticClass:"form-control",class:{"is-invalid":t.hasError},attrs:{type:"text"},domProps:{value:t.url},on:{input:function(e){e.target.composing||(t.url=e.target.value)}}}),e("div",{staticClass:"invalid-feedback"},[t._v(" Required ")])])])},Dn=[],En=(0,a.defineComponent)({props:{visible:{type:Boolean,required:!0}},data(){return{url:"",hasError:!1}},methods:{confirm(t){if(0===this.url.length)return this.hasError=!0,void t.preventDefault();this.$emit("confirm",this.url)},change(){this.hasError=!1,this.url="",this.$emit("update:visible",!1)}}}),Bn=En,zn=(0,y.A)(Bn,Rn,Dn,!1,null,null,null),On=zn.exports,Fn=(0,a.defineComponent)({components:{AddPodcastModal:On},props:{sort:{type:String,default:null}},data(){return{items:null,showAddModal:!1,unsupported:!1}},computed:{sortedItems(){return"a-z"===this.sort?(0,vt.A)(this.items,"name"):(0,vt.A)(this.items,"updatedAt","desc")}},async created(){try{this.items=await this.$api.getPodcasts()}catch(t){if(t instanceof nn)return this.items=[],void(this.unsupported=!0);throw t}},methods:{async refresh(){await this.$api.refreshPodcasts(),this.items=await this.$api.getPodcasts()},async add(t){await this.$api.addPodcast(t),this.items=await this.$api.getPodcasts(),await new Promise((t=>setTimeout(t,1e3))),this.items=await this.$api.getPodcasts()}}}),Un=Fn,jn=(0,y.A)(Un,qn,Nn,!1,null,null,null),Qn=jn.exports,Vn=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("ContentLoader",{attrs:{loading:null==t.playlist},scopedSlots:t._u([{key:"default",fn:function(){return[e("div",{staticClass:"d-flex align-items-center mb-2"},[e("h1",{staticClass:"mb-0 mr-2 text-truncate"},[t._v(" "+t._s(t.playlist.name)+" ")]),t.playlist.isPublic?e("span",{staticClass:"badge badge-light badge-pill mr-2"},[t._v(" Public ")]):t._e(),e("OverflowMenu",{staticClass:"ml-auto"},[e("ContextMenuItem",{attrs:{icon:"edit",disabled:t.playlist.isReadOnly},on:{click:function(e){t.showEditModal=!0}}},[t._v(" Edit ")]),e("b-dropdown-divider"),e("ContextMenuItem",{attrs:{icon:"x",variant:"danger",disabled:t.playlist.isReadOnly},on:{click:function(e){return t.deletePlaylist()}}},[t._v(" Delete ")])],1)],1),t.playlist.comment?e("p",{staticClass:"text-muted"},[t._v(" "+t._s(t.playlist.comment)+" ")]):t._e(),e("b-button",{staticClass:"mr-2",attrs:{variant:"secondary",disabled:0===t.playlist.tracks.length},on:{click:t.playNow}},[e("Icon",{attrs:{icon:"play"}}),t._v(" Play ")],1),e("b-button",{attrs:{variant:"secondary",disabled:0===t.playlist.tracks.length},on:{click:t.shuffleNow}},[e("Icon",{attrs:{icon:"shuffle"}}),t._v(" Shuffle ")],1),t.playlist.tracks.length>0?e("TrackList",{attrs:{tracks:t.playlist.tracks},scopedSlots:t._u([{key:"context-menu",fn:function({index:s}){return[e("b-dropdown-divider"),e("ContextMenuItem",{attrs:{icon:"x",variant:"danger",disabled:t.playlist.isReadOnly},on:{click:function(e){return t.removeTrack(s)}}},[t._v(" Remove ")])]}}],null,!1,4075899818)}):e("EmptyIndicator"),e("EditModal",{attrs:{visible:t.showEditModal,item:t.playlist},on:{"update:visible":function(e){t.showEditModal=e},confirm:t.updatePlaylist},scopedSlots:t._u([{key:"title",fn:function(){return[t._v(" Edit playlist ")]},proxy:!0},{key:"default",fn:function({item:s}){return[e("div",{staticClass:"form-group"},[e("label",[t._v("Name")]),e("input",{directives:[{name:"model",rawName:"v-model",value:s.name,expression:"item.name"}],staticClass:"form-control",attrs:{type:"text"},domProps:{value:s.name},on:{input:function(e){e.target.composing||t.$set(s,"name",e.target.value)}}})]),e("div",{staticClass:"form-group"},[e("label",[t._v("Comment")]),e("textarea",{directives:[{name:"model",rawName:"v-model",value:s.comment,expression:"item.comment"}],staticClass:"form-control",domProps:{value:s.comment},on:{input:function(e){e.target.composing||t.$set(s,"comment",e.target.value)}}})]),e("div",{staticClass:"form-group"},[e("label",{staticClass:"mb-0"},[t._v("Public")]),e("SwitchInput",{model:{value:s.isPublic,callback:function(e){t.$set(s,"isPublic",e)},expression:"item.isPublic"}})],1)]}}])})]},proxy:!0}])})},Hn=[],Gn=(0,a.defineComponent)({components:{SwitchInput:se,TrackList:ri,EditModal:xn},props:{id:{type:String,required:!0}},setup(){return{playlistStore:gt()}},data(){return{playlist:null,showEditModal:!1}},watch:{id:{immediate:!0,handler(t){this.playlist=null,this.$api.getPlaylist(t).then((t=>{this.playlist=t}))}}},methods:{playNow(){return this.$store.dispatch("player/playNow",{tracks:this.playlist.tracks})},shuffleNow(){return this.$store.dispatch("player/shuffleNow",{tracks:this.playlist.tracks})},removeTrack(t){return this.playlist.tracks.splice(t,1),this.playlistStore.removeTrack(this.id,t)},updatePlaylist(t){return this.playlist=t,this.playlistStore.update(this.playlist)},deletePlaylist(){return this.playlistStore.delete(this.id).then((()=>{this.$router.replace({name:"playlists"})}))}}}),Yn=Gn,Zn=(0,y.A)(Yn,Vn,Hn,!1,null,null,null),Jn=Zn.exports,Wn=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",[e("div",{staticClass:"d-flex justify-content-between align-items-center mb-3"},[e("ul",{staticClass:"nav-underlined"},[e("li",[e("router-link",{attrs:{to:{...t.$route,params:{...t.$route.params,sort:null}}}},[t._v(" 最近添加的播放列表 ")])],1),e("li",[e("router-link",{attrs:{to:{...t.$route,params:{...t.$route.params,sort:"a-z"}}}},[t._v(" A-Z首字母排序 ")])],1)])]),t.items.length>0?e("Tiles",{attrs:{square:""}},t._l(t.items,(function(s){return e("Tile",{key:s.id,attrs:{image:s.image,to:{name:"playlist",params:{id:s.id}},title:s.name},scopedSlots:t._u([{key:"text",fn:function(){return[e("strong",[t._v(t._s(s.trackCount))]),t._v(" tracks ")]},proxy:!0},{key:"context-menu",fn:function(){return[e("ContextMenuItem",{attrs:{icon:"play"},on:{click:function(e){return t.playNow(s.id)}}},[t._v(" 播放 ")]),e("ContextMenuItem",{attrs:{icon:"plus"},on:{click:function(e){return t.playNext(s.id)}}},[t._v(" 添加到播放列表 ")]),e("ContextMenuItem",{attrs:{icon:"plus"},on:{click:function(e){return t.playLater(s.id)}}},[t._v(" 添加到播放列表尾端 ")])]},proxy:!0}],null,!0)})})),1):e("EmptyIndicator"),e("CreatePlaylistModal",{attrs:{visible:t.showAddModal},on:{"update:visible":function(e){t.showAddModal=e}}})],1)},Xn=[],Kn=(0,a.defineComponent)({components:{CreatePlaylistModal:xt},props:{sort:{type:String,default:null}},setup(t){const e=gt();return{showAddModal:(0,a.ref)(!1),loading:(0,a.computed)((()=>null===e.playlists)),items:(0,a.computed)((()=>"a-z"===t.sort?(0,vt.A)(e.playlists,"name"):(0,vt.A)(e.playlists,"createdAt","desc")))}},methods:{async playNow(t){const e=await this.$api.getPlaylist(t);return this.$store.dispatch("player/playTrackList",{tracks:e.tracks})},async playNext(t){const e=await this.$api.getPlaylist(t);return this.$store.dispatch("player/setNextInQueue",e.tracks)},async playLater(t){const e=await this.$api.getPlaylist(t);return this.$store.dispatch("player/addToQueue",e.tracks)}}}),to=Kn,eo=(0,y.A)(to,Wn,Xn,!1,null,null,null),so=eo.exports,ao=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("ContentLoader",{attrs:{loading:null==t.result},scopedSlots:t._u([{key:"default",fn:function(){return[t.result.artists.length>0?e("div",{staticClass:"mb-5"},[e("h1",[t._v("社团")]),e("ArtistList",{attrs:{items:t.result.artists}})],1):t._e(),t.result.albums.length>0?e("div",{staticClass:"mb-5"},[e("h1",[t._v("专辑")]),e("AlbumList",{attrs:{items:t.result.albums}})],1):t._e(),t.result.tracks.length>0?e("div",[e("h1",[t._v("曲目")]),e("TrackList",{attrs:{tracks:t.result.tracks}})],1):t._e(),t.hasResult?t._e():e("EmptyIndicator",{attrs:{label:"No results"}})]},proxy:!0}])})},ro=[],io=(0,a.defineComponent)({components:{AlbumList:Fr,ArtistList:Xr,TrackList:ri},props:{query:{type:String,required:!0}},data(){return{result:null}},computed:{hasResult(){return this.result&&(this.result.artists.length>0||this.result.albums.length>0||this.result.tracks.length>0)}},watch:{query:{immediate:!0,handler(t){this.$api.search(t).then((t=>{this.result=t}))}}}}),no=io,oo=(0,y.A)(no,ao,ro,!1,null,null,null),lo=oo.exports,uo=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",[t.items.length>0?e("TrackList",{attrs:{tracks:t.items}}):t._e(),e("InfiniteLoader",{attrs:{loading:t.loading,"has-more":t.hasMore},on:{"load-more":t.loadMore}})],1)},co=[],po=(0,a.defineComponent)({components:{TrackList:ri},props:{id:{type:String,required:!0}},data(){return{loading:!1,hasMore:!0,items:[]}},computed:{generator(){return this.$api.getTracksByArtist(this.id)}},methods:{async loadMore(){this.loading=!0;const{value:t,done:e}=await this.generator.next();void 0!==t&&this.items.push(...t),this.hasMore=!e,this.loading=!1}}}),mo=po,ho=(0,y.A)(mo,uo,co,!1,null,null,null),fo=ho.exports,yo=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",[t._m(0),e("ContentLoader",{attrs:{loading:null===t.item},scopedSlots:t._u([{key:"default",fn:function(){return[e("BaseTable",[e("BaseTableHead"),e("tbody",{staticClass:"text-break"},[t.path?e("tr",{on:{click:t.openParent}},[e("td",[e("Icon",{attrs:{icon:"folder"}})],1),e("td",{attrs:{colspan:"2"}},[t._v(" .. ")])]):t._e(),t._l(t.item.directories,(function(s){return e("tr",{key:s.id,on:{click:function(e){return t.openDirectory(s.id)}}},[e("td",[e("Icon",{attrs:{icon:"folder"}})],1),e("td",{attrs:{colspan:"2"}},[t._v(" "+t._s(s.name)+" ")])])})),t._l(t.item.tracks,(function(s){return e("tr",{key:s.id,class:{active:s.id===t.playingTrackId},on:{click:function(e){return t.playTrack(s)}}},[e("CellTrackNumber",{attrs:{active:s.id===t.playingTrackId&&t.isPlaying,value:s.track}}),e("CellTitle",{attrs:{track:s}}),e("CellActions",{attrs:{track:s}})],1)}))],2)],1)]},proxy:!0}])})],1)},vo=[function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",{staticClass:"d-flex justify-content-between align-items-center mb-2"},[e("h1",{staticClass:"mb-0 mr-2 text-truncate"},[t._v(" Files ")])])}],go=(0,a.defineComponent)({components:{BaseTable:Va,BaseTableHead:Ja,CellTrackNumber:er,CellTitle:wr,CellActions:Tr},props:{path:{type:String,default:""}},data(){return{item:null}},computed:{isPlaying(){return this.$store.getters["player/isPlaying"]},playingTrackId(){return this.$store.getters["player/trackId"]}},watch:{path:{immediate:!0,async handler(t){this.item=null,this.item=await this.$api.getDirectory(t),this.item.tracks=(0,vt.A)(this.item.tracks,["track","title"]),this.item.directories=(0,vt.A)(this.item.directories,"name")}}},methods:{async playNow(){return this.$store.dispatch("player/playNow",{tracks:this.item.tracks})},async shuffleNow(){return this.$store.dispatch("player/shuffleNow",{tracks:this.item.tracks})},async playTrack(t){if(t.id===this.playingTrackId)return this.$store.dispatch("player/playPause");const e=this.item.tracks.findIndex((e=>e.id===t.id));return this.$store.dispatch("player/playTrackList",{index:e,tracks:this.item.tracks})},openDirectory(t){const e=""===this.path?t:[this.path,t].join("/");this.$router.push({path:`/files/${e}`})},openParent(){const t=this.path.split("/").slice(0,-1).join("/");this.$router.push({path:`/files/${t}`})}}}),bo=go,ko=(0,y.A)(bo,yo,vo,!1,null,null,null),_o=ko.exports;function xo(t){const e=new i.Ay({mode:"history",linkExactActiveClass:"active",base:"/",routes:[{path:"/",name:"home",component:Vr},{name:"login",path:"/login",component:Ba,props:t=>({returnTo:t.query.returnTo}),meta:{layout:"fullscreen"}},{name:"queue",path:"/queue",component:qr},{name:"albums-default",path:"/albums",redirect:{name:"albums",params:{sort:"recently-added"}}},{name:"albums",path:"/albums/:sort",component:Ri,props:!0},{name:"album",path:"/albums/id/:id",component:Ti,props:!0},{name:"artists",path:"/artists/:sort?",component:wi,props:!0},{name:"artist",path:"/artists/id/:id",component:vi,props:!0},{name:"artist-tracks",path:"/artists/id/:id/tracks",component:fo,props:!0},{name:"genres",path:"/genres/:sort?",component:Ki,props:!0},{name:"genre",path:"/genres/id/:id/:section?",component:Gi,props:!0},{name:"favourites",path:"/favourites/:section?",component:hn,props:!0},{name:"radio",path:"/radio",component:Sn},{name:"podcasts",path:"/podcasts/:sort?",component:Qn,props:!0},{name:"podcast",path:"/podcasts/id/:id",component:Ln,props:!0},{name:"files",path:"/files/:path*",component:_o,props:!0},{name:"playlists",path:"/playlists/:sort?",component:so,props:!0},{name:"playlist",path:"/playlist/:id",component:Jn,props:!0},{name:"search",path:"/search",component:lo,props:t=>({query:t.query.q})}]});return e.beforeEach(((e,s,a)=>{"login"===e.name||t.isAuthenticated()?a():a({name:"login",query:{returnTo:e.fullPath}})})),e}var wo=s(5645);class Co{constructor(){(0,O.A)(this,"audio",new Audio),(0,O.A)(this,"handle",-1),(0,O.A)(this,"volume",1),(0,O.A)(this,"fadeDuration",200),(0,O.A)(this,"buffer",new Audio),(0,O.A)(this,"statsListener",null),(0,O.A)(this,"ontimeupdate",(()=>{})),(0,O.A)(this,"ondurationchange",(()=>{})),(0,O.A)(this,"onpause",(()=>{})),(0,O.A)(this,"onstreamtitlechange",(()=>{})),(0,O.A)(this,"onended",(()=>{})),(0,O.A)(this,"onerror",(()=>{}))}currentTime(){return this.audio.currentTime}duration(){return this.audio.duration}setBuffer(t){this.buffer.src=t}setVolume(t){this.cancelFade(),this.volume=t,this.audio.volume=t}setPlaybackRate(t){this.audio.playbackRate=t}async pause(){await this.fadeOut(),this.audio.pause()}async resume(){this.audio.volume=0,await this.audio.play(),this.fadeIn()}async seek(t){await this.fadeOut(this.fadeDuration/2),this.audio.volume=0,this.audio.currentTime=t,await this.fadeIn(this.fadeDuration/2)}async changeTrack(t){if(this.audio&&(this.cancelFade(),Ao(this.audio,this.fadeDuration)),this.audio=new Audio(t.url),this.audio.onerror=()=>{this.onerror(this.audio.error)},this.audio.onended=()=>{this.onended()},this.audio.ontimeupdate=()=>{this.ontimeupdate(this.audio.currentTime)},this.audio.ondurationchange=()=>{this.ondurationchange(this.audio.duration)},this.audio.onpause=()=>{this.onpause()},this.ondurationchange(this.audio.duration),this.ontimeupdate(this.audio.currentTime),this.onstreamtitlechange(null),this.audio.volume=0,this.audio.playbackRate=t.playbackRate??1,this.statsListener?.stop(),t.isStream&&(console.info("Icecast: starting stats listener"),this.statsListener=new wo.A(t.url,{sources:["icy"],onStats:t=>{void 0===t?.icy?(console.info("Icecast: no metadata found. Stopping"),this.statsListener?.stop()):t?.icy?.StreamTitle&&this.onstreamtitlechange(t?.icy?.StreamTitle)}}),this.statsListener?.start()),!0!==t.paused){try{await this.audio.play()}catch(e){if(e instanceof Error&&"AbortError"===e.name)return void console.warn(e);throw e}this.fadeIn()}}cancelFade(){clearTimeout(this.handle)}fadeIn(t=this.fadeDuration){this.fadeFromTo(0,this.volume,t).then()}fadeOut(t=this.fadeDuration){return this.fadeFromTo(this.volume,0,t)}fadeFromTo(t,e,s){console.info(`AudioController: start fade (${t}, ${e}, ${s})`);const a=Date.now(),r=(e-t)/s;return s<=0&&(this.audio.volume=e),clearTimeout(this.handle),new Promise((i=>{const n=()=>{if(this.audio.volume===e)return console.info(`AudioController: fade result. duration: ${s}ms, actual: ${Date.now()-a}ms, volume: ${this.audio.volume}`),void i();const o=Date.now()-a;this.audio.volume=Po(0,this.volume,t+o*r),this.handle=setTimeout(n,10)};n()}))}}function Ao(t,e){async function s(t,e,s,a){if(a<=0)return t.volume=s,t;const r=Date.now(),i=(s-e)/a;while(t.volume!==s){const s=Date.now()-r;t.volume=Po(0,1,e+s*i),await So(10)}return t}console.info(`AudioController: ending payback for ${t}`),t.ontimeupdate=null,t.ondurationchange=null,t.onpause=null,t.onerror=null,t.onended=null,t.onloadedmetadata=null;const a=Date.now();s(t,t.volume,0,e).catch((t=>console.warn("Error during fade out: "+t.stack))).finally((()=>{t.pause(),console.info(`AudioController: ending payback done. actual ${Date.now()-a}ms`)}))}function So(t){return new Promise((e=>setTimeout(e,t)))}function Po(t,e,s){return Math.max(t,Math.min(s,e))}localStorage.removeItem("player.mute");const Io=JSON.parse(localStorage.getItem("queue")||"[]"),To=parseInt(localStorage.getItem("queueIndex")||"-1"),$o=parseFloat(localStorage.getItem("player.volume")||"1.0"),Mo=parseFloat(localStorage.getItem("player.podcastPlaybackRate")||"1.0"),Lo=navigator.mediaSession,qo=new Co;function No(t){localStorage.setItem("queue",JSON.stringify(t.queue)),localStorage.setItem("queueIndex",t.queueIndex.toString())}const Ro={namespaced:!0,state:{queue:Io,queueIndex:To,scrobbled:!1,isPlaying:!1,duration:0,currentTime:0,streamTitle:null,repeat:"false"!==localStorage.getItem("player.repeat"),shuffle:"true"===localStorage.getItem("player.shuffle"),volume:$o,podcastPlaybackRate:Mo},mutations:{setPlaying(t){t.isPlaying=!0,Lo&&(Lo.playbackState="playing")},setPaused(t){t.isPlaying=!1,Lo&&(Lo.playbackState="paused")},setRepeat(t,e){t.repeat=e,localStorage.setItem("player.repeat",e)},setShuffle(t,e){t.shuffle=e,localStorage.setItem("player.shuffle",e)},setQueue(t,e){t.queue=e,t.queueIndex=-1,No(t)},setQueueIndex(t,e){if(0===t.queue.length)return;e=Math.max(0,e),e=e<t.queue.length?e:0,t.queueIndex=e,No(t),t.scrobbled=!1;const s=t.queue[e];t.duration=s.duration;const a=(e+1)%t.queue.length;qo.setBuffer(t.queue[a].url),Lo&&(Lo.metadata=new MediaMetadata({title:s.title,artist:Y(s.artists),album:s.album,artwork:s.image?[{src:s.image,sizes:"300x300"}]:void 0}))},addToQueue(t,e){t.queue.push(...e),No(t)},removeFromQueue(t,e){t.queue.splice(e,1),e<t.queueIndex&&t.queueIndex--,No(t)},clearQueue(t){t.queueIndex>=0&&(t.queue=[t.queue[t.queueIndex]],t.queueIndex=0,No(t))},shuffleQueue(t){t.queue.length>0&&(t.queue=V(t.queue,t.queueIndex),t.queueIndex=0,No(t))},setNextInQueue(t,e){t.queue.splice(t.queueIndex+1,0,...e),No(t)},setCurrentTime(t,e){t.currentTime=e},setDuration(t,e){isFinite(e)&&(t.duration=e)},setStreamTitle(t,e){t.streamTitle=e,e&&Lo?.metadata&&(Lo.metadata.title=e)},setScrobbled(t){t.scrobbled=!0},setVolume(t,e){t.volume=e,localStorage.setItem("player.volume",String(e))},setPodcastPlaybackRate(t,e){t.podcastPlaybackRate=e,localStorage.setItem("player.podcastPlaybackRate",String(e))}},actions:{async playNow({commit:t,dispatch:e},{tracks:s}){t("setShuffle",!1),e("playTrackList",{tracks:s,index:0})},async shuffleNow({commit:t,dispatch:e},{tracks:s}){t("setShuffle",!0),e("playTrackList",{tracks:s})},async playTrackListIndex({commit:t,getters:e},{index:s}){t("setQueueIndex",s),t("setPlaying"),await qo.changeTrack({...e.track,playbackRate:e.playbackRate})},async playTrackList({commit:t,state:e,getters:s},{tracks:a,index:r}){null==r&&(r=e.shuffle?Math.floor(Math.random()*a.length):0),e.shuffle&&(a=[...a],Q(a,r),r=0),G(e.queue,a)||t("setQueue",a),t("setQueueIndex",r),t("setPlaying"),await qo.changeTrack({...s.track,playbackRate:s.playbackRate})},async resume({commit:t}){t("setPlaying"),await qo.resume()},async pause({commit:t}){qo.pause(),t("setPaused")},async playPause({state:t,dispatch:e}){return t.isPlaying?e("pause"):e("resume")},async next({commit:t,state:e,getters:s}){t("setQueueIndex",e.queueIndex+1),t("setPlaying"),await qo.changeTrack({...s.track,playbackRate:s.playbackRate})},async previous({commit:t,state:e,getters:s}){t("setQueueIndex",qo.currentTime()>3?e.queueIndex:e.queueIndex-1),t("setPlaying"),await qo.changeTrack(s.track)},seek({state:t},e){isFinite(t.duration)&&qo.seek(t.duration*e)},async resetQueue({commit:t,getters:e}){t("setQueueIndex",0),t("setPaused"),await qo.changeTrack({...e.track,paused:!0,playbackRate:e.playbackRate})},toggleRepeat({commit:t,state:e}){t("setRepeat",!e.repeat)},toggleShuffle({commit:t,state:e}){t("setShuffle",!e.shuffle)},setShuffle({commit:t},e){t("setShuffle",e)},addToQueue({state:t,commit:e},s){e("addToQueue",t.shuffle?V(s):s)},setNextInQueue({state:t,commit:e},s){e("setNextInQueue",t.shuffle?V(s):s)},setVolume({commit:t},e){qo.setVolume(e),t("setVolume",e)},setPlaybackRate({commit:t,getters:e},s){t("setPodcastPlaybackRate",s),e.track?.isPodcast&&qo.setPlaybackRate(s)}},getters:{track(t){return-1!==t.queueIndex?t.queue[t.queueIndex]:null},trackId(t,e){return e.track?e.track.id:-1},isPlaying(t){return t.isPlaying},progress(t){return t.currentTime>-1&&t.duration>0?t.currentTime/t.duration:0},hasNext(t){return t.queueIndex<t.queue.length-1},hasPrevious(t){return t.queueIndex>0},playbackRate(t,e){return e.track?.isPodcast?t.podcastPlaybackRate:1}}};function Do(t,e){const s=new r.Ay.Store({strict:!0,modules:{player:{namespaced:!0,...Ro}}});return Eo(s,t,e),s}function Eo(t,e,s){qo.ontimeupdate=e=>{t.commit("player/setCurrentTime",e)},qo.ondurationchange=e=>{t.commit("player/setDuration",e)},qo.onended=()=>t.getters["player/hasNext"]||t.state.player.repeat?t.dispatch("player/next"):t.dispatch("player/resetQueue"),qo.onpause=()=>{t.commit("player/setPaused")},qo.onstreamtitlechange=e=>{t.commit("player/setStreamTitle",e)},qo.onerror=s=>{t.commit("player/setPaused"),e.setError(s)},qo.setVolume($o);const a=t.getters["player/track"];a?.url&&qo.changeTrack({...a,paused:!0}),qo.setPlaybackRate(t.getters["player/playbackRate"]),Lo&&(Lo.setActionHandler("play",(()=>{t.dispatch("player/resume")})),Lo.setActionHandler("pause",(()=>{t.dispatch("player/pause")})),Lo.setActionHandler("nexttrack",(()=>{t.dispatch("player/next")})),Lo.setActionHandler("previoustrack",(()=>{t.dispatch("player/previous")})),Lo.setActionHandler("stop",(()=>{t.dispatch("player/pause")})),Lo.setActionHandler("seekto",(t=>{t.seekTime&&qo.seek(t.seekTime)})),Lo.setActionHandler("seekforward",(t=>{const e=t.seekOffset||10;qo.seek(Math.min(qo.currentTime()+e,qo.duration()))})),Lo.setActionHandler("seekbackward",(t=>{const e=t.seekOffset||10;qo.seek(Math.max(qo.currentTime()-e,0))})),t.watch(((t,e)=>e["player/trackId"]),(()=>{const{id:e,isStream:a}=t.getters["player/track"];if(!a)return s.updateNowPlaying(e)})),t.watch((t=>t.player.currentTime),(()=>{if(!1===t.state.player.scrobbled&&t.state.player.duration>30&&t.state.player.currentTime/t.state.player.duration>.7){const{id:e,isStream:a}=t.getters["player/track"];if(!a)return t.commit("player/setScrobbled"),s.scrobble(e)}})))}a["default"].use(r.Ay),a["default"].use(i.Ay),a["default"].use(c.R2);const Bo=rt(),zo=cn(Bo),Oo=xo(Bo),Fo=(0,c.Ey)().use((({store:t})=>{t.api=(0,a.markRaw)(zo)})),Uo=p(Fo),jo=Do(Uo,zo);async function Qo(){try{const t=await Bo.autoLogin();t?(Vo.use(Bo),Vo.use(zo),await Promise.all([Ht().load(),gt().load()])):(console.log("自动登录失败"),Oo.push("/login"))}catch(t){console.error("自动登录时发生错误",t),Oo.push("/login")}}Oo.beforeEach(((t,e,s)=>{Uo.clearError(),"/login"===t.path&&Bo.isAuthenticated()?s("/"):"/login"===t.path||Bo.isAuthenticated()?s():s("/login")}));const Vo=ke(be,{router:Oo,pinia:Fo,store:jo});Vo.config.errorHandler=t=>{console.error(t),Uo.setError(t)},Object.entries(Ma).forEach((([t,e])=>{Vo.component(t,e)})),Qo().then((()=>{Vo.mount("#app")}))},6910:function(t,e,s){t.exports=s.p+"img/fallback.a86b9853.svg"}},e={};function s(a){var r=e[a];if(void 0!==r)return r.exports;var i=e[a]={exports:{}};return t[a].call(i.exports,i,i.exports,s),i.exports}s.m=t,function(){var t=[];s.O=function(e,a,r,i){if(!a){var n=1/0;for(c=0;c<t.length;c++){a=t[c][0],r=t[c][1],i=t[c][2];for(var o=!0,l=0;l<a.length;l++)(!1&i||n>=i)&&Object.keys(s.O).every((function(t){return s.O[t](a[l])}))?a.splice(l--,1):(o=!1,i<n&&(n=i));if(o){t.splice(c--,1);var u=r();void 0!==u&&(e=u)}}return e}i=i||0;for(var c=t.length;c>0&&t[c-1][2]>i;c--)t[c]=t[c-1];t[c]=[a,r,i]}}(),function(){s.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return s.d(e,{a:e}),e}}(),function(){s.d=function(t,e){for(var a in e)s.o(e,a)&&!s.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:e[a]})}}(),function(){s.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){s.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}}(),function(){s.p="/"}(),function(){var t={524:0};s.O.j=function(e){return 0===t[e]};var e=function(e,a){var r,i,n=a[0],o=a[1],l=a[2],u=0;if(n.some((function(e){return 0!==t[e]}))){for(r in o)s.o(o,r)&&(s.m[r]=o[r]);if(l)var c=l(s)}for(e&&e(a);u<n.length;u++)i=n[u],s.o(t,i)&&t[i]&&t[i][0](),t[i]=0;return s.O(c)},a=self["webpackChunkairsonic_refix"]=self["webpackChunkairsonic_refix"]||[];a.forEach(e.bind(null,0)),a.push=e.bind(null,a.push.bind(a))}();var a=s.O(void 0,[504],(function(){return s(7474)}));a=s.O(a)})();
//# sourceMappingURL=app.d7c59d7c.js.map